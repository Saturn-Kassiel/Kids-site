@import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,300;0,400;0,500;0,600&display=swap');

/* ===== TOKENS ===== */
:root {
    --grad:        linear-gradient(135deg, #a78bfa, #60a5fa, #34d399);
    --grad-purple: linear-gradient(135deg, #a78bfa, #7c3aed);
    --grad-blue:   linear-gradient(135deg, #93c5fd, #3b82f6);
    --grad-pink:   linear-gradient(135deg, #f9a8d4, #ec4899);
    --grad-yellow: linear-gradient(135deg, #fde68a, #f59e0b);
    --grad-green:  linear-gradient(135deg, #6ee7b7, #10b981);
    --grad-orange: linear-gradient(135deg, #fdba74, #f97316);
    --grad-red:    linear-gradient(135deg, #fca5a5, #ef4444);
    --grad-teal:   linear-gradient(135deg, #5eead4, #0d9488);

    --bg:      #f0f4ff;
    --bg2:     #e8eeff;
    --card:    #ffffff;
    --card2:   #f5f8ff;
    --text:    #1a1f3c;
    --text2:   #5a6080;
    --border:  rgba(90,96,128,0.13);
    --shadow:  0 4px 20px rgba(80,100,200,0.10);
    --shadow-lg: 0 8px 36px rgba(80,100,200,0.18);
    --radius:  20px;
    --radius-sm: 13px;
    --font: 'Plus Jakarta Sans', system-ui, sans-serif;
    --font-display: 'Plus Jakarta Sans', system-ui, sans-serif;
    --fw-normal: 400;
    --fw-medium: 500;
    --fw-semi:   600;
    --tr: 0.22s cubic-bezier(.4,0,.2,1);
    --accent: #60a5fa;
}

/* ══ ПАЛИТРА LUNA для тёмной темы ══
   #A7EBF2 — светлый акцент (текст, иконки)
   #54ACBF — средний акцент (кнопки, прогресс)
   #26658C — основной синий (карточки)
   #023859 — тёмный фон карточек
   #011C40 — самый тёмный фон */
[data-theme="dark"] {
    --luna-light:  #A7EBF2;
    --luna-mid:    #54ACBF;
    --luna-main:   #26658C;
    --luna-dark:   #023859;
    --luna-deep:   #011C40;

    --bg:      #011C40;
    --bg2:     #023859;
    --card:    #0a2d54;
    --card2:   #0d3464;
    --text:    #d4f0f5;
    --text2:   #7ab8cc;
    --border:  rgba(84,172,191,0.18);
    --shadow:  0 4px 24px rgba(1,28,64,0.6);
    --shadow-lg: 0 8px 40px rgba(1,28,64,0.8);

    --grad:        linear-gradient(135deg, #54ACBF, #A7EBF2);
    --grad-purple: linear-gradient(135deg, #26658C, #54ACBF);
    --grad-blue:   linear-gradient(135deg, #023859, #26658C);
    --grad-pink:   linear-gradient(135deg, #54ACBF, #A7EBF2);
    --grad-yellow: linear-gradient(135deg, #A7EBF2, #54ACBF);
    --grad-green:  linear-gradient(135deg, #54ACBF, #26658C);
    --grad-orange: linear-gradient(135deg, #26658C, #54ACBF);
    --grad-red:    linear-gradient(135deg, #023859, #26658C);
    --grad-teal:   linear-gradient(135deg, #A7EBF2, #54ACBF);
    --accent: #54ACBF;
}

/* ===== RESET ===== */
*, *::before, *::after {
    box-sizing: border-box; margin: 0; padding: 0;
    font-family: 'Plus Jakarta Sans', system-ui, sans-serif;
    font-weight: 400; /* Тонкий шрифт везде по умолчанию */
}
html { scroll-behavior: smooth; overflow: hidden; height: 100vh; height: 100dvh; touch-action: manipulation; }

/* ── SVG Icons ── */
.icon-svg {
    width: 1em; height: 1em;
    display: inline-block;
    vertical-align: -0.15em;
    flex-shrink: 0;
    pointer-events: none;
}
.btn-icon { width: 1.1em; height: 1.1em; vertical-align: -0.2em; }
.hint-svg  { width: 1em;  height: 1em;   vertical-align: -0.15em; }
.stat-icon .icon-svg { width: 1.4em; height: 1.4em; vertical-align: middle; }
.s-icon .icon-svg    { width: 1.3em; height: 1.3em; vertical-align: middle; }
.heart-icon { width: 0.85em; height: 0.85em; color: #f87171; vertical-align: -0.1em; }
.star-gold  { width: 1em; height: 1em; }
.puzzle-placeholder { width: 3em; height: 3em; opacity: 0.4; }
#play-btn .icon-svg, #play-btn svg { width: 1.2em; height: 1.2em; vertical-align: middle; }
.ctrl-btn .icon-svg, .ctrl-btn svg { width: 1em; height: 1em; vertical-align: middle; }
.admin-edit .icon-svg, .admin-del .icon-svg { width: 1em; height: 1em; vertical-align: middle; }


body {
    background: var(--bg);
    color: var(--text);
    font-family: var(--font);
    font-weight: 400;
    transition: background var(--tr), color var(--tr);
    -webkit-tap-highlight-color: transparent;
    height: 100vh;
    height: 100dvh;
    overflow: hidden;
    overscroll-behavior: none;
}
section::-webkit-scrollbar, .stats-scroll::-webkit-scrollbar, .admin-list::-webkit-scrollbar { width: 5px; }
section::-webkit-scrollbar-thumb, .stats-scroll::-webkit-scrollbar-thumb, .admin-list::-webkit-scrollbar-thumb { background: var(--grad); border-radius: 99px; }

/* ══ ГЛОБАЛЬНЫЙ ЗАПРЕТ НА ЖИРНЫЙ ШРИФТ ══ */
* { font-weight: 400 !important; }
/* Исключения: только там где нужно чуть выделить — medium/semi */
.track-name, .song-name, h1, h2, h3, .home-logo,
#page-title-bar, .modal-title, .admin-item-title,
.s-label, .stat-num, .level-tab {
    font-weight: 500 !important;
}
input, select, textarea, button, label, option {
    font-family: 'Plus Jakarta Sans', system-ui, sans-serif !important;
    font-weight: 400 !important;
}
/* ===== LAYOUT ===== */
#app {
    max-width: 480px;
    margin: 0 auto;
    height: 100vh;
    height: 100dvh;
    position: relative;
    display: flex;
    flex-direction: column;
    overflow: hidden;
}
@media(min-width:600px) { #app { box-shadow: 0 0 60px rgba(0,0,0,0.12); } }

/* ===== TOP BAR ===== */
#top-bar {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 14px 18px 10px;
    position: sticky;
    top: 0;
    z-index: 200;
    background: transparent;
    backdrop-filter: none;
}
#back-btn {
    display: flex;
    align-items: center;
    gap: 7px;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 12px;
    padding: 8px 15px;
    font-family: 'Plus Jakarta Sans', sans-serif;
    font-size: 14px;
    font-weight: 500 !important;
    color: var(--text2);
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: all var(--tr);
}
#back-btn:hover { transform: translateX(-3px); }
#back-btn svg { width: 17px; height: 17px; }
#page-title-bar {
    font-family: var(--font-display);
    font-size: 21px;
    background: var(--grad);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    flex: 1;
}
#settings-icon-btn {
    background: var(--card);
    border: none;
    border-radius: 12px;
    width: 38px; height: 38px;
    font-size: 18px;
    cursor: pointer;
    box-shadow: var(--shadow);
    display: flex; align-items: center; justify-content: center;
    transition: all var(--tr);
}
#settings-icon-btn:hover { transform: rotate(25deg) scale(1.1); }

/* ===== SECTIONS ===== */
section { flex: 1; min-height: 0; padding: 0 18px 28px; padding-bottom: calc(28px + env(safe-area-inset-bottom, 0px)); animation: fadeInUp 0.35s ease both; overflow-y: auto; }

/* ══ Stats layout: fixed header + scrollable body ══ */
section.stats-layout {
    padding: 0;
    display: flex;
    flex-direction: column;
    /* flex: 1 уже задан на section; min-height: 0 позволяет flex-item сжиматься */
    min-height: 0;
    overflow: hidden;
}
.stats-fixed {
    flex-shrink: 0;
    padding: 14px 18px 14px;
    background: var(--bg);
    /* Лёгкая тень отделяет от скролла */
    box-shadow: 0 4px 12px rgba(0,0,0,0.08);
    position: relative;
    z-index: 1;
}
.stats-scroll {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 14px 18px 32px;
}
/* Убираем лишний margin у chart-card в закрепе */
.stats-fixed .chart-card  { margin-bottom: 0; }
section.hidden { display: none !important; }
.hidden { display: none !important; }
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(14px); }
    to   { opacity: 1; transform: translateY(0); }
}

/* ===== MAIN / HOME ===== */
#main { padding-top: 10px; }

/* ── Home Hero: маскот + приветствие ── */
.home-hero {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 8px 4px 18px;
    min-height: 80px;
    position: relative;
    z-index: 1;
    animation: fadeInUp 0.45s ease both;
}
.home-mascot-wrap {
    flex-shrink: 0;
    width: 72px; height: 72px;
    border-radius: 22px;
    background: var(--card);
    box-shadow: var(--shadow);
    overflow: hidden;
    display: block;
    animation: mascotBounce 2s ease infinite;
    animation-delay: 0.5s;
}
.home-mascot {
    width: 72px; height: 72px;
    object-fit: cover;
    display: block;
}
@keyframes mascotBounce {
    0%, 100% { transform: translateY(0); }
    15% { transform: translateY(-4px) rotate(-2deg); }
    30% { transform: translateY(0); }
}
.home-hero-text {
    flex: 1;
    min-width: 0;
}
.home-logo {
    font-size: 28px;
    background: var(--grad);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    line-height: 1.15;
    font-weight: 500 !important;
    font-family: var(--font-display);
    letter-spacing: -0.01em;
    display: block;
}
.home-greeting {
    font-size: 14px;
    color: var(--text2);
    margin-top: 3px;
    line-height: 1.35;
    min-height: 19px;
    display: block;
}
/* Тёмная тема — маскот с лёгким glow */
[data-theme="dark"] .home-mascot-wrap {
    box-shadow: 0 4px 24px rgba(84,172,191,0.2), var(--shadow);
}
.menu-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
}
/* Плашки — иконки + цветовые акценты */
.menu-card {
    background: var(--card);
    border: 1.5px solid var(--border);
    padding: 18px 14px 16px;
    border-radius: 18px;
    box-shadow: var(--shadow);
    cursor: pointer;
    font-size: 14px;
    color: var(--text);
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    text-align: center;
    gap: 8px;
    line-height: 1.3;
    transition: all var(--tr);
    text-decoration: none;
    min-height: 88px;
    position: relative;
    overflow: hidden;
}
.menu-card::before {
    content: '';
    position: absolute;
    inset: 0;
    opacity: 0.07;
    border-radius: 18px;
    transition: opacity var(--tr);
    pointer-events: none;
}
.menu-card:hover::before { opacity: 0.12; }
.menu-card:hover  { transform: translateY(-3px); box-shadow: var(--shadow-lg); }
.menu-card:active { transform: scale(0.97); }

/* Иконка на карточке */
.mc-icon {
    width: 36px; height: 36px;
    border-radius: 11px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
    transition: transform var(--tr);
}
.menu-card:hover .mc-icon { transform: scale(1.1); }
.mc-icon svg {
    width: 22px; height: 22px;
}
.mc-label {
    font-size: 13px;
    line-height: 1.25;
}

/* ── Цветовые акценты для каждой карточки ── */
.mc-alphabet::before { background: linear-gradient(135deg, #a78bfa, #7c3aed); }
.mc-alphabet .mc-icon { background: rgba(167,139,250,0.15); color: #a78bfa; }

.mc-numbers::before { background: linear-gradient(135deg, #60a5fa, #3b82f6); }
.mc-numbers .mc-icon { background: rgba(96,165,250,0.15); color: #60a5fa; }

.mc-colors::before { background: linear-gradient(135deg, #f9a8d4, #ec4899); }
.mc-colors .mc-icon { background: rgba(236,72,153,0.15); color: #ec4899; }

.mc-words::before { background: linear-gradient(135deg, #fbbf24, #f59e0b); }
.mc-words .mc-icon { background: rgba(245,158,11,0.15); color: #f59e0b; }

.mc-math::before { background: linear-gradient(135deg, #a78bfa, #7c3aed); }
.mc-math .mc-icon { background: rgba(124,58,237,0.15); color: #a78bfa; }

.mc-songs::before { background: linear-gradient(135deg, #6ee7b7, #10b981); }
.mc-songs .mc-icon { background: rgba(16,185,129,0.15); color: #10b981; }

.mc-podcasts::before { background: linear-gradient(135deg, #5eead4, #0d9488); }
.mc-podcasts .mc-icon { background: rgba(13,148,136,0.15); color: #0d9488; }

.mc-puzzles::before { background: linear-gradient(135deg, #fdba74, #f97316); }
.mc-puzzles .mc-icon { background: rgba(249,115,22,0.15); color: #f97316; }

.mc-riddles::before { background: linear-gradient(135deg, #fde68a, #eab308); }
.mc-riddles .mc-icon { background: rgba(234,179,8,0.15); color: #eab308; }

.mc-finger::before { background: linear-gradient(135deg, #f9a8d4, #e879a8); }
.mc-finger .mc-icon { background: rgba(232,121,168,0.15); color: #e879a8; }

.mc-articul::before { background: linear-gradient(135deg, #fca5a5, #ef4444); }
.mc-articul .mc-icon { background: rgba(239,68,68,0.15); color: #ef4444; }

.mc-breath::before { background: linear-gradient(135deg, #93c5fd, #6aa1e8); }
.mc-breath .mc-icon { background: rgba(106,161,232,0.15); color: #6aa1e8; }

.mc-info::before { background: linear-gradient(135deg, #a5b4fc, #818cf8); }
.mc-info .mc-icon { background: rgba(129,140,248,0.15); color: #818cf8; }

.mc-stats::before { background: linear-gradient(135deg, #86efac, #22c55e); }
.mc-stats .mc-icon { background: rgba(34,197,94,0.15); color: #22c55e; }

.mc-badges::before { background: linear-gradient(135deg, #fde68a, #f59e0b); }
.mc-badges .mc-icon { background: rgba(245,158,11,0.15); color: #f59e0b; }
.mc-badges { position: relative; }
.mc-badge-count {
    position: absolute;
    top: 10px;
    right: 10px;
    min-width: 22px;
    height: 22px;
    border-radius: 11px;
    background: linear-gradient(135deg, #f59e0b, #d97706);
    color: #fff;
    font-size: 12px;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 0 6px;
    box-shadow: 0 2px 8px rgba(245,158,11,0.4);
}

/* ── Card count badges ── */
.mc-count {
    position: absolute;
    min-width: 20px; height: 20px;
    border-radius: 10px;
    font-size: 11px; font-weight: 700;
    display: none; align-items: center; justify-content: center;
    padding: 0 5px; line-height: 1;
}
.mc-count-total {
    top: 8px; left: 8px;
    background: rgba(255,255,255,0.15); color: rgba(255,255,255,0.8);
    backdrop-filter: blur(4px);
}
.mc-count-new {
    top: 8px; right: 8px;
    background: linear-gradient(135deg, #34d399, #10b981);
    color: #fff;
    box-shadow: 0 2px 6px rgba(16,185,129,0.4);
    animation: notif-pop 0.3s ease;
}

.mc-settings::before { background: linear-gradient(135deg, #94a3b8, #64748b); }
.mc-settings .mc-icon { background: rgba(100,116,139,0.15); color: #94a3b8; }

/* ── Тёмная тема: чуть ярче иконки ── */
[data-theme="dark"] .mc-alphabet .mc-icon { background: rgba(167,139,250,0.2); color: #c4b5fd; }
[data-theme="dark"] .mc-numbers .mc-icon  { background: rgba(96,165,250,0.2); color: #93c5fd; }
[data-theme="dark"] .mc-colors .mc-icon   { background: rgba(236,72,153,0.2); color: #f9a8d4; }
[data-theme="dark"] .mc-words .mc-icon    { background: rgba(245,158,11,0.2); color: #fbbf24; }
[data-theme="dark"] .mc-math .mc-icon     { background: rgba(124,58,237,0.2); color: #c4b5fd; }
[data-theme="dark"] .mc-songs .mc-icon    { background: rgba(16,185,129,0.2); color: #6ee7b7; }
[data-theme="dark"] .mc-podcasts .mc-icon { background: rgba(13,148,136,0.2); color: #5eead4; }
[data-theme="dark"] .mc-puzzles .mc-icon  { background: rgba(249,115,22,0.2); color: #fdba74; }
[data-theme="dark"] .mc-riddles .mc-icon  { background: rgba(234,179,8,0.2); color: #fde68a; }
[data-theme="dark"] .mc-finger .mc-icon   { background: rgba(232,121,168,0.2); color: #f9a8d4; }
[data-theme="dark"] .mc-articul .mc-icon  { background: rgba(239,68,68,0.2); color: #fca5a5; }
[data-theme="dark"] .mc-breath .mc-icon   { background: rgba(106,161,232,0.2); color: #93c5fd; }
[data-theme="dark"] .mc-info .mc-icon     { background: rgba(129,140,248,0.2); color: #a5b4fc; }
[data-theme="dark"] .mc-stats .mc-icon    { background: rgba(34,197,94,0.2); color: #86efac; }
[data-theme="dark"] .mc-badges .mc-icon   { background: rgba(245,158,11,0.2); color: #fde68a; }
[data-theme="dark"] .mc-settings .mc-icon { background: rgba(100,116,139,0.2); color: #94a3b8; }
[data-theme="dark"] .menu-card::before { opacity: 0.1; }
[data-theme="dark"] .menu-card:hover::before { opacity: 0.18; }

/* ===== MEDIA PAGE ===== */
#video-wrap {
    width: 100%;
    border-radius: 18px;
    overflow: hidden;
    background: linear-gradient(135deg, #0d1b2e 0%, #1a2744 100%);
    aspect-ratio: 1/1;
    position: relative;
    margin-bottom: 12px;
    border: 1.5px solid rgba(255,255,255,0.06);
    box-shadow: var(--shadow);
}
#video-wrap video {
    width: 100%; height: 100%;
    object-fit: cover;
    pointer-events: none;
    display: none; /* скрыт по умолчанию, показывается когда видео загружено */
}
.video-placeholder-inner {
    position: absolute; inset: 0;
    display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    gap: 10px; color: rgba(255,255,255,0.55);
    font-size: 15px; letter-spacing: 0.02em;
}
.video-placeholder-inner .pi {
    font-size: 52px; opacity: 0.35;
    filter: drop-shadow(0 2px 8px rgba(0,0,0,0.4));
}

/* ===== AUDIO PLAYER — стиль референса ===== */
.audio-player {
    background: linear-gradient(135deg, #7c4dff 0%, #26a69a 100%);
    border-radius: 18px;
    padding: 14px 18px;
    box-shadow: 0 8px 32px rgba(124,77,255,0.25);
    margin-bottom: 12px;
    position: relative;
    overflow: hidden;
}
/* Лёгкое мерцание — оверлей */
.audio-player::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgba(255,255,255,0.08) 0%, rgba(0,0,0,0.06) 100%);
    border-radius: 18px;
    pointer-events: none;
}

/* Название трека над плеером — белое */
.track-info {
    display: none; /* скрываем — трек-инфо переносим над прогрессом */
}

/* Строка: название + длительность */
.player-track-row {
    display: flex; align-items: center; justify-content: space-between;
    margin-bottom: 10px;
}
.track-name {
    font-size: 14px;
    color: rgba(255,255,255,0.9);
    font-weight: 500 !important;
    white-space: nowrap; overflow: visible;
}
.track-sub { font-size: 11px; color: rgba(255,255,255,0.6); margin-top: 0; }

/* Строка с кнопкой play + прогресс + время */
.player-main-row {
    display: flex; align-items: center; gap: 12px;
}

/* Прогресс-бар — посередине */
.progress-bar-wrap {
    flex: 1;
    height: 5px;
    background: rgba(255,255,255,0.25);
    border-radius: 99px;
    cursor: pointer;
    position: relative;
    margin-bottom: 0;
}
.progress-bar-wrap > div {
    height: 100%;
    background: rgba(255,255,255,0.85);
    border-radius: 99px;
    width: 0%;
    transition: width 0.3s linear;
    position: relative;
}
/* Овальная ручка на прогрессе */
.progress-bar-wrap > div::after {
    content: '';
    position: absolute;
    right: -7px; top: 50%;
    transform: translateY(-50%);
    width: 14px; height: 14px;
    background: white;
    border-radius: 50%;
    box-shadow: 0 2px 8px rgba(0,0,0,0.3);
}

/* Время — белое, по бокам прогресса */
.progress-times {
    display: none; /* встроим время в player-main-row */
}
.player-time {
    font-size: 12px;
    color: rgba(255,255,255,0.85);
    white-space: nowrap;
    min-width: 36px;
}
.player-time-cur { text-align: right; }
.player-time-dur { text-align: left; }

/* Кнопки управления — снизу */
.player-btns {
    display: flex; align-items: center; justify-content: center;
    gap: 24px;
    margin-top: 14px;
}

/* Вспомогательные кнопки */
.ctrl-btn {
    background: rgba(255,255,255,0.15);
    border: none;
    width: 36px; height: 36px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer;
    color: rgba(255,255,255,0.85);
    font-size: 16px;
    border-radius: 50%;
    transition: all var(--tr);
    padding: 0;
    backdrop-filter: blur(4px);
}
.ctrl-btn:hover  { background: rgba(255,255,255,0.28); color: white; transform: scale(1.1); }
.ctrl-btn:active { transform: scale(0.90); }
.ctrl-btn.active { background: rgba(255,255,255,0.35); color: white; }

/* Кнопка Play — белый круг с тенью */
#play-btn, #song-play-btn, #podcast-play-btn {
    width: 52px; height: 52px;
    border-radius: 50%;
    background: white;
    border: none;
    cursor: pointer;
    color: #7c4dff;
    font-size: 20px;
    display: flex; align-items: center; justify-content: center;
    transition: all var(--tr);
    box-shadow: 0 4px 20px rgba(0,0,0,0.2);
    padding: 0;
    flex-shrink: 0;
}
#play-btn:hover, #song-play-btn:hover, #podcast-play-btn:hover {
    transform: scale(1.08);
    box-shadow: 0 6px 28px rgba(0,0,0,0.3);
}
#play-btn:active, #song-play-btn:active, #podcast-play-btn:active {
    transform: scale(0.94);
}

/* ===== CHIPS GRID ===== */
.chips-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
    gap: 8px;
}
.chip {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 14px;
    padding: 10px 4px;
    text-align: center;
    font-family: var(--font-display);
    font-size: 19px;
    cursor: pointer;
    transition: all var(--tr);
    box-shadow: var(--shadow);
}
.chip:hover  { transform: scale(1.1); border-color: #a78bfa; }
.chip:active { transform: scale(0.92); }
.chip.active { background: var(--grad); color: white; border-color: transparent; box-shadow: 0 3px 12px rgba(120,100,220,0.3); }

/* Color chips */
.color-chip {
    border-radius: 14px;
    padding: 13px 6px;
    text-align: center;
    font-family: var(--font-display);
    font-size: 13px;
    cursor: pointer;
    color: white;
    font-weight: 500 !important;
    text-shadow: 0 1px 3px rgba(0,0,0,0.3);
    transition: all var(--tr);
    box-shadow: var(--shadow);
}
.color-chip:hover  { transform: scale(1.06); }
.color-chip:active { transform: scale(0.93); }
.color-chip.active { outline: 3px solid white; outline-offset: 2px; }

/* ===== SONGS ===== */
.search-bar {
    display: flex; align-items: center; gap: 10px;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 14px;
    padding: 10px 15px;
    box-shadow: var(--shadow);
    margin-bottom: 10px;
}
.search-bar input {
    flex: 1; border: none; background: transparent;
    font-family: var(--font); font-size: 15px; color: var(--text); outline: none;
}
.search-bar input::placeholder { color: var(--text2); }
.songs-list {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 18px;
    box-shadow: var(--shadow);
    overflow: hidden;
    max-height: 52vh;
    overflow-y: auto;
}
.song-item {
    display: flex; align-items: center; padding: 11px 15px; gap: 11px;
    cursor: pointer; transition: background var(--tr);
    border-bottom: 1px solid var(--border);
}
.song-item:last-child { border-bottom: none; }
.song-item:hover { background: var(--card2); }
.song-item.playing { background: linear-gradient(90deg, rgba(167,139,250,0.08), transparent); }
.song-num { width: 26px; text-align: center; font-size: 12px; color: var(--text2); font-weight: 500 !important; font-family: 'Plus Jakarta Sans', sans-serif; flex-shrink: 0; }
.song-num.pi-icon { color: #7c3aed; }
.song-name { flex: 1; font-weight: 500 !important; font-size: 14px; font-family: 'Plus Jakarta Sans', sans-serif; }
.song-dur  { font-size: 12px; color: var(--text2); }
.deeplink-btn {
    flex-shrink: 0;
    background: none;
    border: 1.5px solid var(--border);
    border-radius: 8px;
    padding: 3px 7px;
    font-size: 13px;
    color: var(--text2);
    cursor: pointer;
    opacity: 0;
    transition: opacity 0.15s, background 0.15s, color 0.15s;
    margin-left: 4px;
    line-height: 1;
}
.song-item:hover .deeplink-btn { opacity: 1; }
.deeplink-btn:hover { background: var(--card2); color: #54ACBF; border-color: #54ACBF; }
/* На тач-устройствах hover не работает — показываем всегда */
@media (hover: none) {
    .deeplink-btn { opacity: 0.5; }
    .deeplink-btn:active { opacity: 1; background: var(--card2); color: #54ACBF; border-color: #54ACBF; }
}

/* ===== RIDDLES / PUZZLES ===== */
.riddle-card {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 22px;
    box-shadow: var(--shadow);
    overflow: hidden;
    margin-bottom: 14px;
}
.riddle-text-area {
    padding: 28px 22px 24px;
    font-family: var(--font-display);
    font-size: 17px;
    line-height: 1.7;
    text-align: center;
    white-space: pre-line;
    color: var(--text);
}
.riddle-answer-area {
    padding: 0 16px 16px;
}
.riddle-answer-area input[type=text] {
    margin-bottom: 6px;
    border-radius: 12px;
    padding: 11px 14px;
    font-size: 15px;
}
/* Reusable box for other sections using riddle-box */
.riddle-box {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 18px;
    padding: 22px 18px;
    font-family: var(--font-display);
    font-size: 20px;
    line-height: 1.6;
    text-align: center;
    box-shadow: var(--shadow);
    white-space: pre-line;
    margin-bottom: 10px;
}
.hint-box {
    background: rgba(234,179,8,0.08);
    border: 1.5px solid rgba(234,179,8,0.25);
    border-radius: 14px;
    padding: 12px 15px;
    font-size: 14px; font-weight: 500 !important;
    line-height: 1.5;
    margin-bottom: 10px;
    color: var(--text);
}
.hint-box .icon-svg { color: #eab308; vertical-align: -0.15em; }
.puzzle-card {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 22px;
    box-shadow: var(--shadow);
    overflow: hidden;
}
.puzzle-img-area {
    width: 100%; aspect-ratio: 1/1;
    display: flex; align-items: center; justify-content: center;
    font-size: 64px;
    overflow: hidden;
    background: var(--card2);
}
.puzzle-img-area img {
    width: 100%; height: 100%; object-fit: contain; display: block;
}
.puzzle-answer-area {
    padding: 12px 16px 16px;
}
.puzzle-answer-area .hint-box {
    margin-bottom: 8px;
    padding: 9px 12px;
    font-size: 13px;
    border-radius: 10px;
}
.puzzle-answer-area input[type=text] {
    margin-bottom: 6px;
    border-radius: 12px;
    padding: 11px 14px;
    font-size: 15px;
}
.answer-img {
    display: none;
    width: 100%;
    text-align: center;
    font-size: 80px;
    border-radius: 22px;
    margin-top: 0;
    animation: fadeInUp 0.4s ease;
}
.answer-img.show {
    display: block;
    background: var(--card);
    border: 1.5px solid var(--border);
    padding: 20px;
    box-shadow: var(--shadow);
    border-radius: 22px;
}

input[type=text], input[type=password] {
    width: 100%;
    padding: 13px 15px;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 14px;
    font-family: var(--font);
    font-size: 16px;
    color: var(--text);
    outline: none;
    transition: border-color var(--tr), box-shadow var(--tr);
    margin-bottom: 8px;
}
input:focus { border-color: #a78bfa; box-shadow: 0 0 0 3px rgba(167,139,250,0.12); }
input.correct { border-color: #10b981; background: #10b98108; box-shadow: 0 0 0 3px rgba(16,185,129,0.1); }
input.wrong   { border-color: #ef4444; background: #ef444408; box-shadow: 0 0 0 3px rgba(239,68,68,0.1); }

.action-btn, .submit-btn {
    width: 100%;
    padding: 14px;
    background: var(--grad);
    border: none;
    border-radius: 14px;
    font-family: var(--font-display);
    font-size: 18px;
    font-weight: 500 !important;
    color: white;
    cursor: pointer;
    box-shadow: 0 4px 14px rgba(120,100,220,0.25);
    transition: all var(--tr);
    margin-top: 4px;
}
.action-btn:hover, .submit-btn:hover { transform: translateY(-2px); box-shadow: 0 6px 22px rgba(120,100,220,0.35); }
.action-btn:active, .submit-btn:active { transform: scale(0.97); }
/* Строка кнопок загадки */
.riddle-btns-row {
    display: flex; gap: 8px; margin-top: 4px;
}
.riddle-btns-row .submit-btn {
    flex: 1.4; margin-top: 0; font-size: 14px; padding: 11px 10px;
    border-radius: 12px;
}
.riddle-btns-row .next-btn {
    flex: 1; margin-top: 0; font-size: 14px; padding: 11px 10px;
    border-radius: 12px;
}
.next-btn {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    width: 100%; padding: 12px;
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 14px;
    font-family: var(--font-display); font-size: 16px;
    font-weight: 500 !important;
    color: var(--text2); cursor: pointer;
    transition: all var(--tr); margin-top: 8px;
}
.next-btn:hover { border-color: #a78bfa; color: var(--text); transform: translateY(-1px); }
/* Кнопка поделиться загадкой в топ-баре */
#riddle-share-topbar, #puzzle-share-topbar {
    display: flex; align-items: center; justify-content: center;
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 12px;
    padding: 8px 13px;
    cursor: pointer;
    box-shadow: var(--shadow);
    transition: all var(--tr);
    flex-shrink: 0;
    color: var(--text2);
}
#riddle-share-topbar:hover, #puzzle-share-topbar:hover { transform: scale(1.05); color: var(--text); }
#riddle-msg, #puzzle-msg {
    text-align: center;
    font-family: var(--font-display);
    font-size: 14px;
    font-weight: 500 !important;
    padding: 8px;
    border-radius: 10px;
    min-height: 0;
    margin-top: 4px;
    margin-bottom: 2px;
}
#riddle-msg.ok, #puzzle-msg.ok { color: #10b981; background: rgba(16,185,129,0.08); }
#riddle-msg.err, #puzzle-msg.err { color: #ef4444; background: rgba(239,68,68,0.08); }
#riddle-msg.warn, #puzzle-msg.warn { color: #f59e0b; background: rgba(245,158,11,0.08); }

.level-tabs { display: flex; gap: 8px; margin-bottom: 12px; }
.level-tab {
    flex: 1; padding: 9px;
    border: 1.5px solid var(--border); border-radius: 14px;
    background: var(--card); font-family: var(--font-display); font-size: 14px;
    font-weight: 500 !important;
    color: var(--text2); cursor: pointer; transition: all var(--tr); text-align: center;
}
.level-tab.easy   { background: rgba(74,222,128,0.15);  color: #16a34a; border-color: rgba(74,222,128,0.3); }
.level-tab.medium { background: rgba(250,204,21,0.15); color: #ca8a04; border-color: rgba(250,204,21,0.3); }
.level-tab.hard   { background: rgba(248,113,113,0.15); color: #dc2626; border-color: rgba(248,113,113,0.3); }

/* Кружки уровней в топ-баре ребусов */
#puzzle-level-dots, #riddle-level-dots {
    display: flex; gap: 9px; align-items: center; margin-right: 2px;
}
.lvl-dot {
    width: 20px; height: 20px; border-radius: 50%;
    border: 2.5px solid transparent;
    cursor: pointer; transition: transform 0.15s, opacity 0.15s, box-shadow 0.15s;
    opacity: 0.3; padding: 0; flex-shrink: 0;
}
.lvl-dot.easy   { background: #4ade80; }
.lvl-dot.medium { background: #facc15; }
.lvl-dot.hard   { background: #f87171; }
.lvl-dot.active { opacity: 1; transform: scale(1.25); box-shadow: 0 0 8px 2px rgba(255,255,255,0.2); border-color: rgba(255,255,255,0.35); }
.lvl-dot:hover:not(.active) { opacity: 0.7; transform: scale(1.1); }

/* ═══ NOTIFICATIONS ═══ */
#notif-bell-btn {
    background: var(--card); border: none;
    border-radius: 12px; width: 38px; height: 38px;
    cursor: pointer; box-shadow: var(--shadow);
    display: flex; align-items: center; justify-content: center;
    transition: all var(--tr); position: relative;
    color: var(--text);
}
#notif-bell-btn:active { transform: scale(0.92); }
.notif-badge {
    position: absolute; top: -3px; right: -3px;
    background: #ef4444; color: #fff;
    font-size: 10px; font-weight: 700;
    min-width: 18px; height: 18px;
    border-radius: 9px; padding: 0 5px;
    display: flex; align-items: center; justify-content: center;
    box-shadow: 0 2px 6px rgba(239,68,68,0.4);
    animation: notif-pop 0.3s ease;
}
@keyframes notif-pop {
    0% { transform: scale(0); }
    60% { transform: scale(1.3); }
    100% { transform: scale(1); }
}
.notif-empty {
    text-align: center; padding: 60px 20px;
    color: var(--text2); font-size: 15px;
    display: flex; flex-direction: column; align-items: center;
}
.notif-item {
    display: flex; gap: 12px; padding: 14px 16px;
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 16px; box-shadow: var(--shadow);
    margin-bottom: 8px; animation: fadeInUp 0.3s ease;
}
.notif-icon {
    width: 40px; height: 40px; border-radius: 12px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
}
.notif-icon-songs     { background: rgba(139,92,246,0.12); color: #8b5cf6; }
.notif-icon-podcasts  { background: rgba(16,185,129,0.12); color: #10b981; }
.notif-icon-riddles   { background: rgba(59,130,246,0.12); color: #3b82f6; }
.notif-icon-puzzles   { background: rgba(245,158,11,0.12); color: #f59e0b; }
.notif-icon-message   { background: rgba(99,102,241,0.12); color: #6366f1; }
.notif-body { flex: 1; min-width: 0; }
.notif-title { font-family: var(--font-display); font-size: 14px; font-weight: 600; color: var(--text); margin-bottom: 2px; }
.notif-text { font-size: 13px; color: var(--text2); line-height: 1.4; }
.notif-date { font-size: 11px; color: var(--text2); opacity: 0.5; margin-top: 4px; }
.notif-compose {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 18px; padding: 16px; box-shadow: var(--shadow);
}
[data-theme="dark"] .notif-item { background: var(--card); }
[data-theme="dark"] #notif-bell-btn { background: var(--card); }

/* ═══ REGISTRATION CARD ═══ */
.reg-card {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 22px;
    padding: 28px 20px 22px;
    box-shadow: var(--shadow);
    display: flex; flex-direction: column; align-items: center;
    gap: 10px;
    margin-bottom: 16px;
    text-align: center;
}
.reg-avatar {
    width: 64px; height: 64px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--accent), #a78bfa);
    display: flex; align-items: center; justify-content: center;
    color: #fff;
    margin-bottom: 4px;
}
.reg-card.has-name .reg-avatar {
    width: 56px; height: 56px;
    background: linear-gradient(135deg, #34d399, #10b981);
    font-family: var(--font-display);
    font-size: 22px; font-weight: 600;
    color: #fff;
}
.reg-name-display {
    font-family: var(--font-display);
    font-size: 22px; font-weight: 600;
    color: var(--text);
    line-height: 1.3;
}
.reg-input-wrap {
    display: flex; gap: 8px; width: 100%; max-width: 280px;
}
.reg-input-wrap input[type=text] {
    flex: 1; margin-bottom: 0;
    padding: 10px 14px;
    font-size: 15px;
    border-radius: 12px;
    text-align: center;
    background: var(--card2);
}
.reg-save-btn {
    padding: 10px 18px;
    background: var(--grad);
    border: none; border-radius: 12px;
    font-family: var(--font-display);
    font-size: 14px; font-weight: 500;
    color: #fff; cursor: pointer;
    white-space: nowrap;
    box-shadow: 0 3px 10px rgba(120,100,220,0.25);
    transition: all var(--tr);
}
.reg-save-btn:active { transform: scale(0.96); }
.reg-hint {
    font-size: 12px; color: var(--text2);
    opacity: 0.6; line-height: 1.4;
    max-width: 260px;
}
.reg-edit-btn {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 7px 14px;
    background: var(--card2);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    font-family: var(--font); font-size: 13px;
    color: var(--text2); cursor: pointer;
    transition: all var(--tr);
    margin-top: 2px;
}
.reg-edit-btn:active { transform: scale(0.96); }
[data-theme="dark"] .reg-card { background: var(--card); }
[data-theme="dark"] .reg-edit-btn { background: var(--card2); }

/* ===== SETTINGS ===== */
.settings-group {
    background: var(--card); border-radius: 18px;
    border: 1.5px solid var(--border);
    box-shadow: var(--shadow); overflow: hidden; margin-bottom: 14px;
}
.settings-row {
    display: flex; align-items: center; padding: 14px 16px; gap: 13px;
    border-bottom: 1px solid var(--border); transition: background var(--tr);
}
.settings-row:last-child { border-bottom: none; }
.settings-row:hover { background: var(--card2); }
.s-icon  {
    width: 38px; height: 38px; border-radius: 11px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
}
.s-icon .icon-svg { width: 20px; height: 20px; }
.settings-row > div:not(.toggle) { flex: 1; min-width: 0; }
.s-label { font-weight: 500 !important; font-size: 15px; }
.s-sub   { font-size: 12px; color: var(--text2); margin-top: 2px; }

/* ── Цвета иконок настроек ── */
.si-profile    { background: rgba(96,165,250,0.12); color: #60a5fa; }
.si-theme      { background: rgba(167,139,250,0.12); color: #a78bfa; }
.si-snd-riddle { background: rgba(234,179,8,0.12); color: #eab308; }
.si-snd-puzzle { background: rgba(249,115,22,0.12); color: #f97316; }
.si-snd-achieve { background: rgba(250,204,21,0.12); color: #facc15; }
.si-snd-words   { background: rgba(245,158,11,0.12); color: #f59e0b; }
.si-snd-math    { background: rgba(124,58,237,0.12); color: #7c3aed; }
.si-sync       { background: rgba(13,148,136,0.12); color: #0d9488; }
.si-export     { background: rgba(16,185,129,0.12); color: #10b981; }
.si-import     { background: rgba(96,165,250,0.12); color: #60a5fa; }
.si-reset      { background: rgba(239,68,68,0.10); color: #ef4444; }

[data-theme="dark"] .si-profile    { background: rgba(96,165,250,0.18); color: #93c5fd; }
[data-theme="dark"] .si-theme      { background: rgba(167,139,250,0.18); color: #c4b5fd; }
[data-theme="dark"] .si-snd-riddle { background: rgba(234,179,8,0.18); color: #fde68a; }
[data-theme="dark"] .si-snd-puzzle { background: rgba(249,115,22,0.18); color: #fdba74; }
[data-theme="dark"] .si-snd-achieve { background: rgba(250,204,21,0.18); color: #fef08a; }
[data-theme="dark"] .si-snd-words   { background: rgba(245,158,11,0.18); color: #fbbf24; }
[data-theme="dark"] .si-snd-math    { background: rgba(124,58,237,0.18); color: #c4b5fd; }
[data-theme="dark"] .si-sync       { background: rgba(13,148,136,0.18); color: #5eead4; }
[data-theme="dark"] .si-export     { background: rgba(16,185,129,0.18); color: #6ee7b7; }
[data-theme="dark"] .si-import     { background: rgba(96,165,250,0.18); color: #93c5fd; }
[data-theme="dark"] .si-reset      { background: rgba(239,68,68,0.15); color: #fca5a5; }

.toggle {
    width: 47px; height: 26px; background: var(--bg2);
    border-radius: 99px; position: relative; cursor: pointer;
    transition: background var(--tr); flex-shrink: 0;
    margin-left: auto;
}
.toggle.on { background: var(--grad); }
.toggle::after {
    content: ''; position: absolute;
    width: 20px; height: 20px; background: white;
    border-radius: 50%; top: 3px; left: 3px;
    transition: left var(--tr); box-shadow: 0 2px 6px rgba(0,0,0,0.2);
}
.toggle.on::after { left: 24px; }

/* ── Sync / Settings group title ── */
.settings-group-title {
    font-size: 12px; font-weight: 500 !important; text-transform: uppercase;
    letter-spacing: 0.08em; color: var(--text2); padding: 4px 4px 8px; margin-top: 6px;
}
.sync-btn {
    display: inline-flex; align-items: center; gap: 5px;
    padding: 7px 14px; margin-left: auto; flex-shrink: 0;
    background: var(--card2); border: 1.5px solid var(--border);
    border-radius: 12px; font-family: var(--font);
    font-size: 13px; font-weight: 500 !important; color: var(--text);
    cursor: pointer; transition: all var(--tr);
}
.sync-btn:hover { border-color: #60a5fa; background: var(--bg2); }
.sync-btn:disabled { opacity: 0.5; cursor: not-allowed; }
.sync-btn .icon-svg { width: 15px; height: 15px; }

/* ===== STATS ===== */
.stat-card {
    background: var(--card); border-radius: 18px;
    border: 1.5px solid var(--border);
    padding: 16px; box-shadow: var(--shadow);
    display: flex; align-items: center; gap: 14px; margin-bottom: 10px;
    position: relative; overflow: hidden;
    transition: all var(--tr);
}
.stat-card::before {
    content: '';
    position: absolute; inset: 0;
    opacity: 0.05; border-radius: 18px;
    pointer-events: none;
}
.stat-icon {
    width: 44px; height: 44px; border-radius: 13px;
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0;
}
.stat-icon .icon-svg { width: 22px; height: 22px; }
.stat-val      { font-family: var(--font-display); font-size: 26px; line-height: 1; font-weight: 500 !important; }
.stat-val-sm   { font-family: var(--font-display); font-size: 22px; line-height: 1; font-weight: 500 !important; }
.stat-val-time { font-family: var(--font-display); font-size: 20px; line-height: 1; font-weight: 500 !important; }
.stat-lbl      { font-size: 13px; color: var(--text2); font-weight: 500 !important; margin-top: 3px; }
.stat-sub      { font-size: 12px; color: var(--text2); margin-top: 2px; min-height: 16px; }
.stat-hint     { font-size: 11px; color: var(--text2); margin-top: 5px; opacity: 0.6; line-height: 1.35; }
.stat-track    { width: 100%; height: 6px; background: var(--bg2); border-radius: 99px; margin-top: 7px; overflow: hidden; }
.stat-fill     { height: 100%; border-radius: 99px; width: 0%; transition: width 1s ease; }

/* ── Цветовые акценты статистики ── */
.si-puzzles    { background: rgba(249,115,22,0.12); color: #f97316; }
.sf-puzzles    { background: linear-gradient(90deg, #fdba74, #f97316); }
.stat-card:has(.si-puzzles)::before { background: linear-gradient(135deg, #fdba74, #f97316); }

.si-riddles    { background: rgba(234,179,8,0.12); color: #eab308; }
.sf-riddles    { background: linear-gradient(90deg, #fde68a, #eab308); }
.stat-card:has(.si-riddles)::before { background: linear-gradient(135deg, #fde68a, #eab308); }

.si-words      { background: rgba(245,158,11,0.12); color: #f59e0b; }
.sf-words      { background: linear-gradient(90deg, #fbbf24, #d97706); }
.stat-card:has(.si-words)::before { background: linear-gradient(135deg, #fbbf24, #d97706); }

.si-math       { background: rgba(124,58,237,0.12); color: #7c3aed; }
.sf-math       { background: linear-gradient(90deg, #a78bfa, #7c3aed); }
.stat-card:has(.si-math)::before { background: linear-gradient(135deg, #a78bfa, #7c3aed); }

.si-songs      { background: rgba(16,185,129,0.12); color: #10b981; }
.sf-songs      { background: linear-gradient(90deg, #6ee7b7, #10b981); }
.stat-card:has(.si-songs)::before { background: linear-gradient(135deg, #6ee7b7, #10b981); }

.si-time-songs { background: rgba(167,139,250,0.12); color: #a78bfa; }
.stat-card:has(.si-time-songs)::before { background: linear-gradient(135deg, #a78bfa, #7c3aed); }

.si-podcasts   { background: rgba(13,148,136,0.12); color: #0d9488; }
.stat-card:has(.si-podcasts)::before { background: linear-gradient(135deg, #5eead4, #0d9488); }

.si-letters    { background: rgba(167,139,250,0.12); color: #a78bfa; }
.stat-card:has(.si-letters)::before { background: linear-gradient(135deg, #a78bfa, #7c3aed); }

.si-numbers    { background: rgba(96,165,250,0.12); color: #60a5fa; }
.stat-card:has(.si-numbers)::before { background: linear-gradient(135deg, #60a5fa, #3b82f6); }

.si-colors     { background: rgba(236,72,153,0.12); color: #ec4899; }
.stat-card:has(.si-colors)::before { background: linear-gradient(135deg, #f9a8d4, #ec4899); }

.si-ach-riddles  { background: rgba(234,179,8,0.12); color: #eab308; }
.stat-card:has(.si-ach-riddles)::before { background: linear-gradient(135deg, #fde68a, #eab308); }

.si-ach-puzzles  { background: rgba(249,115,22,0.12); color: #f97316; }
.stat-card:has(.si-ach-puzzles)::before { background: linear-gradient(135deg, #fdba74, #f97316); }

/* Тёмная тема — ярче иконки */
[data-theme="dark"] .si-puzzles    { background: rgba(249,115,22,0.18); color: #fdba74; }
[data-theme="dark"] .si-riddles    { background: rgba(234,179,8,0.18); color: #fde68a; }
[data-theme="dark"] .si-words      { background: rgba(245,158,11,0.18); color: #fbbf24; }
[data-theme="dark"] .si-math       { background: rgba(124,58,237,0.18); color: #c4b5fd; }
[data-theme="dark"] .si-songs      { background: rgba(16,185,129,0.18); color: #6ee7b7; }
[data-theme="dark"] .si-time-songs { background: rgba(167,139,250,0.18); color: #c4b5fd; }
[data-theme="dark"] .si-podcasts   { background: rgba(13,148,136,0.18); color: #5eead4; }
[data-theme="dark"] .si-letters    { background: rgba(167,139,250,0.18); color: #c4b5fd; }
[data-theme="dark"] .si-numbers    { background: rgba(96,165,250,0.18); color: #93c5fd; }
[data-theme="dark"] .si-colors     { background: rgba(236,72,153,0.18); color: #f9a8d4; }
[data-theme="dark"] .si-ach-riddles  { background: rgba(234,179,8,0.18); color: #fde68a; }
[data-theme="dark"] .si-ach-puzzles  { background: rgba(249,115,22,0.18); color: #fdba74; }
[data-theme="dark"] .stat-card::before { opacity: 0.08; }
[data-theme="dark"] .stat-val-time { color: var(--text); }

.stat-section-hdr {
    font-family: var(--font-display);
    font-size: 12px; font-weight: 500 !important;
    letter-spacing: 0.08em; text-transform: uppercase;
    color: var(--text2);
    padding: 4px 4px 8px;
    margin-top: 6px;
}

.stat-ach-card { align-items: flex-start; }
.stat-ach-card .stat-icon { margin-top: 2px; }
.ach-stat-row {
    display: flex; align-items: center; justify-content: space-between;
    padding: 5px 0;
    border-bottom: 1px solid var(--border);
}
.ach-stat-row:last-child { border-bottom: none; }
.ach-stat-row.ach-stat-empty { opacity: 0.35; }
.ach-stat-label { font-size: 13px; color: var(--text); font-weight: 500 !important; }
.ach-stat-val   { font-family: var(--font-display); font-size: 15px; font-weight: 500 !important; }
.ach-stat-none  { font-size: 13px; color: var(--text2); padding: 6px 0; }

.stat-footer {
    text-align: center; color: var(--text2);
    font-size: 13px; font-weight: 500 !important;
    margin-top: 16px; margin-bottom: 4px;
    display: flex; align-items: center; justify-content: center; gap: 5px;
}

/* ===== INFO ===== */
/* Аккордеон для раздела Информация */
.info-accordion {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 18px;
    box-shadow: var(--shadow);
    margin-bottom: 10px;
    overflow: hidden;
    transition: box-shadow var(--tr);
}
.info-acc-header {
    flex: 1; display: flex; align-items: center; justify-content: space-between;
    padding: 16px 18px;
    background: none; border: none; cursor: pointer;
    text-align: left; gap: 12px;
}
.info-acc-header-row {
    display: flex; align-items: center;
}
.info-deeplink-btn {
    flex-shrink: 0;
    background: none; border: none;
    padding: 16px 14px 16px 4px;
    font-size: 15px; cursor: pointer;
    opacity: 0.35; transition: opacity 0.15s;
    line-height: 1;
}
.info-accordion:hover .info-deeplink-btn,
.info-accordion.open .info-deeplink-btn { opacity: 0.7; }
.info-deeplink-btn:hover { opacity: 1 !important; }
@media (hover: none) {
    .info-deeplink-btn { opacity: 0.5; }
}
.info-acc-title {
    font-family: var(--font-display); font-size: 17px;
    color: var(--text); font-weight: 500 !important;
    flex: 1;
}
.info-acc-arrow {
    font-size: 22px; color: var(--text2);
    transition: transform 0.25s; display: inline-block; flex-shrink: 0;
    line-height: 1;
}
.info-accordion.open .info-acc-arrow { transform: rotate(90deg); }
.info-acc-body {
    max-height: 0; overflow: hidden;
    transition: max-height 0.5s ease, padding 0.25s;
    padding: 0 18px;
}
.info-accordion.open .info-acc-body {
    max-height: 9999px;
    padding: 0 18px 16px;
}
.info-acc-body p { color: var(--text2); font-size: 13px; font-weight: 300 !important; line-height: 1.75; margin: 0; }
.info-link {
    color: #60a5fa;
    text-decoration: underline;
    text-decoration-color: rgba(96,165,250,0.3);
    text-underline-offset: 3px;
    font-weight: 500 !important;
    transition: color 0.2s, text-decoration-color 0.2s;
}
.info-link:hover { color: #93c5fd; text-decoration-color: rgba(147,197,253,0.5); }

/* ── Диалог подтверждения удаления ── */
#confirm-overlay {
    position: fixed; inset: 0; z-index: 1000;
    background: rgba(0,0,0,0.45);
    display: flex; align-items: center; justify-content: center;
    opacity: 0; transition: opacity 0.18s;
    padding: 20px;
}
#confirm-overlay.visible { opacity: 1; }
.confirm-box {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 18px;
    padding: 24px 22px 18px;
    width: 100%; max-width: 320px;
    box-shadow: 0 20px 60px rgba(0,0,0,0.3);
    transform: translateY(12px);
    transition: transform 0.18s;
}
#confirm-overlay.visible .confirm-box { transform: translateY(0); }
.confirm-msg {
    font-size: 16px; color: var(--text);
    font-weight: 500 !important;
    margin-bottom: 20px; line-height: 1.5;
    font-family: var(--font-display);
}
.confirm-btns {
    display: flex; gap: 10px; justify-content: flex-end;
}
.confirm-cancel {
    padding: 10px 18px;
    background: var(--card2); border: 1.5px solid var(--border);
    border-radius: 12px;
    font-family: var(--font); font-size: 14px; color: var(--text2);
    cursor: pointer; transition: all var(--tr);
}
.confirm-cancel:hover { background: var(--card); color: var(--text); }
.confirm-ok {
    padding: 10px 18px;
    background: rgba(239,68,68,0.1); border: 1.5px solid rgba(239,68,68,0.3);
    border-radius: 12px;
    font-family: var(--font); font-size: 14px; color: #ef4444;
    cursor: pointer; transition: all var(--tr);
}
.confirm-ok:hover { background: rgba(239,68,68,0.2); border-color: #ef4444; }

/* ===== ADMIN ===== */
.admin-tabs {
    display: flex; gap: 8px; flex-wrap: wrap;
    margin-bottom: 14px;
}
.admin-tab {
    flex-shrink: 0; padding: 8px 16px;
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 99px; font-family: var(--font-display); font-size: 14px;
    font-weight: 500 !important;
    cursor: pointer; transition: all var(--tr); color: var(--text2);
}
.admin-tab.active { background: var(--grad); color: white; border-color: transparent; }
.admin-list {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    min-height: 0;
}
.admin-item {
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 14px; padding: 13px 15px;
    margin-bottom: 8px; display: flex; align-items: center; gap: 10px; box-shadow: var(--shadow);
}
.admin-item-info { flex: 1; }
.admin-item-title { font-weight: 500 !important; font-size: 14px; font-family: 'Plus Jakarta Sans', sans-serif; }
.admin-item-sub   { font-size: 12px; color: var(--text2); margin-top: 2px; font-family: 'Plus Jakarta Sans', sans-serif; }
.admin-del {
    background: rgba(239,68,68,0.1); border: none; border-radius: 10px;
    width: 32px; height: 32px; color: #ef4444; cursor: pointer;
    display: flex; align-items: center; justify-content: center; font-size: 15px;
    transition: all var(--tr);
}
.admin-del:hover  { background: #ef4444; color: white; }
.admin-edit {
    background: rgba(59,130,246,0.1); border: none; border-radius: 10px;
    width: 32px; height: 32px; color: #3b82f6; cursor: pointer;
    display: flex; align-items: center; justify-content: center; font-size: 15px;
    transition: all var(--tr); margin-right: 3px;
}
.admin-edit:hover { background: #3b82f6; color: white; }
.admin-add-btn {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    width: 100%; padding: 13px; margin-top: 10px; flex-shrink: 0;
    background: var(--grad); border: none; border-radius: 14px;
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 17px; font-weight: 500 !important; color: white;
    cursor: pointer; box-shadow: 0 4px 14px rgba(120,100,220,0.25);
    transition: all var(--tr);
}
.admin-add-btn:hover { transform: translateY(-2px); }
.admin-batch-btn {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    width: 100%; padding: 13px; margin-top: 6px; flex-shrink: 0;
    background: rgba(249,115,22,0.12); border: 1.5px solid rgba(249,115,22,0.25);
    border-radius: 14px;
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 17px; font-weight: 500 !important; color: #f97316;
    cursor: pointer;
    transition: all var(--tr);
}
.admin-batch-btn:hover { transform: translateY(-2px); background: rgba(249,115,22,0.18); }
.admin-batch-btn.hidden { display: none; }

/* ── Batch preview list ── */
.batch-item {
    display: flex; align-items: center; gap: 10px;
    padding: 10px; margin-top: 8px;
    background: var(--card2); border: 1.5px solid var(--border);
    border-radius: 14px;
}
.batch-item-thumb {
    width: 56px; height: 56px; border-radius: 10px;
    object-fit: cover; flex-shrink: 0;
    background: var(--bg2);
}
.batch-item-fields { flex: 1; min-width: 0; display: flex; flex-direction: column; gap: 5px; }
.batch-item-fields input {
    width: 100%; padding: 7px 10px;
    background: var(--card); border: 1.5px solid var(--border);
    border-radius: 10px; font-size: 14px; color: var(--text);
    font-family: var(--font); outline: none;
}
.batch-item-fields input:focus { border-color: #60a5fa; }
.batch-item-remove {
    width: 32px; height: 32px; flex-shrink: 0;
    background: none; border: none; cursor: pointer;
    color: var(--text2); border-radius: 10px;
    display: flex; align-items: center; justify-content: center;
    transition: all var(--tr);
}
.batch-item-remove:hover { background: rgba(239,68,68,0.12); color: #ef4444; }

.publish-btn {
    display: flex; align-items: center; justify-content: center; gap: 8px;
    width: 100%; padding: 13px; margin-top: 8px; flex-shrink: 0;
    background: rgba(167,139,250,0.12); border: 1.5px solid rgba(167,139,250,0.25);
    border-radius: 14px;
    font-family: 'Plus Jakarta Sans', sans-serif; font-size: 17px; font-weight: 500 !important; color: #a78bfa;
    cursor: pointer;
    transition: all var(--tr);
}
.publish-btn:hover { transform: translateY(-2px); background: rgba(167,139,250,0.18); }
.publish-btn:disabled { opacity: 0.5; cursor: not-allowed; transform: none; }

/* ── GitHub Token поле ── */
.github-token-row {
    background: var(--card2);
    border: 1.5px solid var(--border);
    border-radius: 14px;
    padding: 12px 14px;
    margin-top: 8px;
}
.github-token-label {
    font-size: 12px;
    color: var(--text2);
    margin-bottom: 6px;
    letter-spacing: 0.03em;
    font-weight: 500 !important;
}
.github-token-input-wrap {
    display: flex; align-items: center; gap: 6px;
}
.github-token-input-wrap input {
    flex: 1;
    background: var(--bg2);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    padding: 9px 12px;
    font-size: 13px;
    color: var(--text);
    font-family: 'SF Mono', 'Fira Code', monospace;
    letter-spacing: 0.03em;
    outline: none;
    transition: border-color var(--tr);
}
.github-token-input-wrap input:focus {
    border-color: #60a5fa;
}
.github-token-eye {
    background: var(--bg2);
    border: 1.5px solid var(--border);
    border-radius: 10px;
    width: 36px; height: 36px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; font-size: 14px;
    transition: all var(--tr); flex-shrink: 0;
}
.github-token-eye:hover { background: var(--card); }
.github-token-hint {
    font-size: 11px;
    color: var(--text2);
    margin-top: 6px;
}


/* ===== ADMIN LAYOUT ===== */
#admin {
    display: flex;
    flex-direction: column;
    padding-bottom: 18px;
    /* Subtract top-bar height so list fills remaining space */
    max-height: calc(100vh - 70px);
    max-height: calc(100dvh - 70px);
}

/* ===== ADMIN FOOTER (pinned buttons) ===== */
.admin-footer {
    flex-shrink: 0;
    padding-top: 4px;
}
/* ===== MODAL ===== */
.modal-overlay {
    position: fixed; inset: 0;
    background: rgba(0,0,0,0.35);
    display: flex; align-items: center; justify-content: center;
    z-index: 9999;
    animation: fadeInUp 0.2s ease;
    padding: 18px;
}
.modal-box {
    background: var(--card);
    border: 1.5px solid var(--border);
    width: 100%; max-width: 444px;
    border-radius: 18px;
    padding: 22px 20px;
    display: flex; flex-direction: column; gap: 10px;
    box-shadow: var(--shadow-lg);
}
.modal-title { font-family: var(--font-display); font-size: 20px; margin-bottom: 2px; font-weight: 500 !important; }
.modal-btns  { display: flex; gap: 8px; margin-top: 4px; }
.modal-cancel {
    flex: 1; padding: 12px; background: var(--bg2); border: 1.5px solid var(--border);
    border-radius: 14px; font-family: var(--font-display);
    font-size: 16px; font-weight: 500 !important; color: var(--text2); cursor: pointer;
    transition: all var(--tr);
}
.modal-cancel:hover { background: var(--card); color: var(--text); }
.modal-save {
    flex: 2; padding: 12px; background: var(--grad); border: none;
    border-radius: 14px; font-family: var(--font-display);
    font-size: 16px; font-weight: 500 !important; color: white; cursor: pointer;
    box-shadow: 0 3px 10px rgba(120,100,220,0.25);
    transition: all var(--tr);
}
.modal-save:hover { transform: translateY(-1px); }
.file-label {
    display: flex; align-items: center; gap: 8px;
    padding: 10px 13px; background: var(--bg2);
    border: 2px dashed var(--border); border-radius: 14px;
    cursor: pointer; font-size: 14px; color: var(--text2);
    transition: border-color var(--tr);
}
.file-label:hover { border-color: #a78bfa; }
input[type=file] { display: none; }
.file-chosen { font-size: 12px; color: var(--text2); margin-top: -4px; }

/* ===== TOAST ===== */
#toast {
    position: fixed; bottom: 80px; left: 50%;
    transform: translateX(-50%) translateY(16px);
    background: var(--card); color: var(--text);
    border: 1.5px solid var(--border);
    padding: 11px 20px; border-radius: 14px;
    box-shadow: var(--shadow-lg); font-weight: 500 !important; font-size: 14px;
    z-index: 9000; opacity: 0; pointer-events: none;
    transition: all 0.28s; white-space: nowrap;
}
#toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ===== STARS ===== */
.stars-host { position: fixed; inset: 0; pointer-events: none; z-index: 9998; overflow: hidden; }
.star {
    position: absolute; border-radius: 50%;
    animation: starFly var(--dur, 1s) ease-out forwards;
}
@keyframes starFly {
    0%   { transform: translate(0,0) scale(1); opacity: 1; }
    100% { transform: translate(var(--tx),var(--ty)) scale(0); opacity: 0; }
}

/* ===== SPINNER ===== */
#loader {
    position: fixed; inset: 0;
    background: var(--bg); display: flex;
    align-items: center; justify-content: center;
    z-index: 9999;
}
.spinner {
    width: 46px; height: 46px; border-radius: 50%;
    border: 4px solid var(--border);
    border-top-color: #a78bfa;
    animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

/* ===== GRADIENT TEXT ===== */
.gradient-text {
    background: var(--grad);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    font-family: var(--font-display);
    text-align: center;
    padding-top: 4px;
}
.counter-badge { font-size: 13px; color: var(--text2); font-weight: 500 !important; }

.w100 { width: 100%; }
.sp8  { height: 8px; }
.sp12 { height: 12px; }

/* ===== RIDDLE PICTURE PREVIEW ===== */
.answer-img.riddle-pic-preview {
    display: none;
    align-items: center;
    justify-content: center;
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 22px;
    padding: 0;
    overflow: hidden;
    width: 75%;
    max-width: 280px;
    aspect-ratio: 1/1;
    margin: 0 auto 10px;
    box-shadow: var(--shadow);
}
/* !important нужен чтобы перебить .answer-img.show { display: block } */
.answer-img.riddle-pic-preview.show {
    display: flex !important;
}
.answer-img.riddle-pic-preview img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 0;
}

/* ══ MODAL PICTURE PREVIEW ══ */
#m-pic-preview {
    display: none;
    width: 100%;
    aspect-ratio: 1/1;
    object-fit: contain;
    border-radius: 14px;
    background: var(--card2);
    border: 1.5px solid var(--border);
    margin-bottom: 8px;
    max-height: 180px;
}
.m-current-file {
    font-size: 12px;
    color: var(--text2);
    margin-bottom: 6px;
    padding: 6px 10px;
    background: var(--card2);
    border-radius: 8px;
    word-break: break-all;
    display: none;
}
.m-current-file.visible { display: block; }

/* ══ DARK MODE — ПАЛИТРА LUNA ══
   #A7EBF2 #54ACBF #26658C #023859 #011C40 */

/* Плеер в тёмной теме — кнопка play белая на тёмном */





/* Прогресс-бар */




/* Карточки меню */
[data-theme="dark"] .menu-card {
    background: #0a2d54;
    border: 1px solid rgba(38,101,140,0.3);
    color: #d4f0f5;
    box-shadow: 0 4px 20px rgba(1,28,64,0.5);
}
[data-theme="dark"] .menu-card:hover {
    background: #0d3464;
    border-color: rgba(84,172,191,0.35);
    box-shadow: 0 6px 28px rgba(1,28,64,0.7);
}
/* Цветные полоски на плашках в тёмной теме — через Luna */














/* Поля ввода */
[data-theme="dark"] input[type=text],
[data-theme="dark"] input[type=password],
[data-theme="dark"] textarea,
[data-theme="dark"] select {
    background: #023859;
    border-color: rgba(38,101,140,0.5);
    color: #d4f0f5;
}
[data-theme="dark"] input[type=text]:focus,
[data-theme="dark"] textarea:focus {
    border-color: #60a5fa;
    box-shadow: 0 0 0 3px rgba(96,165,250,0.15);
}

/* Кнопка назад */
[data-theme="dark"] #back-btn {
    background: var(--card);
    border-color: var(--border);
    color: var(--text2);
}

/* Треки в списке */
[data-theme="dark"] .song-item {
    border-bottom-color: var(--border);
}
[data-theme="dark"] .song-item:hover { background: var(--card2); }
[data-theme="dark"] .song-item.playing {
    background: linear-gradient(90deg, rgba(84,172,191,0.08), transparent);
}
[data-theme="dark"] .pi-icon { color: #60a5fa; }

/* Админка */
[data-theme="dark"] .admin-tab {
    border-color: var(--border);
    color: var(--text2);
    background: transparent;
}
[data-theme="dark"] .admin-tab.active {
    background: var(--grad);
    border-color: transparent;
    color: #011C40;
}
[data-theme="dark"] .admin-item {
    border-color: var(--border);
    background: var(--card);
}

/* Модалка */
[data-theme="dark"] .modal-box {
    background: var(--card2);
    box-shadow: 0 20px 60px rgba(1,28,64,0.8);
}

/* Подсказка */
[data-theme="dark"] .hint-box {
    background: rgba(234,179,8,0.08);
    border-color: rgba(234,179,8,0.2);
}
[data-theme="dark"] .hint-box .icon-svg { color: #fde68a; }

/* Загадки и ребусы */
[data-theme="dark"] .riddle-box { background: var(--card); }
[data-theme="dark"] .riddle-card { background: var(--card); }
[data-theme="dark"] .puzzle-card { background: var(--card); }
[data-theme="dark"] .puzzle-img-area { background: var(--card2); }

/* Кнопки */
[data-theme="dark"] .submit-btn {
    background: linear-gradient(135deg, #54ACBF, #A7EBF2);
    color: #011C40;
    box-shadow: 0 4px 20px rgba(84,172,191,0.25);
}
[data-theme="dark"] .next-btn {
    background: var(--card);
    border-color: var(--border);
    color: var(--text2);
}

/* Уровни */
[data-theme="dark"] .level-tab.easy   { background: rgba(74,222,128,0.12); color: #6ee7b7; border-color: rgba(74,222,128,0.2); }
[data-theme="dark"] .level-tab.medium { background: rgba(250,204,21,0.12); color: #fde68a; border-color: rgba(250,204,21,0.2); }
[data-theme="dark"] .level-tab.hard   { background: rgba(248,113,113,0.12); color: #fca5a5; border-color: rgba(248,113,113,0.2); }
/* Кружки уровней НЕ перекрашиваем в тёмной теме — они всегда цветные */
[data-theme="dark"] .lvl-dot.easy   { background: #4ade80; }
[data-theme="dark"] .lvl-dot.medium { background: #facc15; }
[data-theme="dark"] .lvl-dot.hard   { background: #f87171; }

/* Настройки и статистика */
[data-theme="dark"] .settings-group {
    background: var(--card);
    border-color: var(--border);
}
/* Чипы */
[data-theme="dark"] .chip {
    background: var(--card);
    border-color: var(--border);
    color: var(--text);
}
[data-theme="dark"] .chip.active {
    background: var(--grad);
    border-color: transparent;
    color: #011C40;
}

/* Заголовок страницы */
[data-theme="dark"] #page-title-bar {
    color: #A7EBF2;
    -webkit-text-fill-color: #A7EBF2;
}

/* Скроллбар */
[data-theme="dark"] ::-webkit-scrollbar-track { background: #011C40; }
[data-theme="dark"] ::-webkit-scrollbar-thumb { background: linear-gradient(180deg,#54ACBF,#26658C); }

/* ── Описание подкаста ── */
.podcast-desc {
    font-size: 12px;
    color: rgba(255,255,255,0.5);
    margin-top: 4px;
    line-height: 1.5;
    display: none;
}
.podcast-desc:not(:empty) { display: block; }

/* ── Плеер в тёмной теме LUNA ── */
[data-theme="dark"] .audio-player {
    background: linear-gradient(135deg, #26658C 0%, #011C40 100%);
    box-shadow: 0 8px 32px rgba(1,28,64,0.6);
}
[data-theme="dark"] #play-btn,
[data-theme="dark"] #song-play-btn,
[data-theme="dark"] #podcast-play-btn {
    background: #A7EBF2;
    color: #011C40;
    box-shadow: 0 4px 20px rgba(167,235,242,0.35);
}
[data-theme="dark"] .ctrl-btn {
    background: rgba(167,235,242,0.12);
    color: rgba(167,235,242,0.8);
}
[data-theme="dark"] .ctrl-btn:hover { background: rgba(167,235,242,0.25); color: #A7EBF2; }
[data-theme="dark"] .ctrl-btn.active { background: rgba(167,235,242,0.3); color: #A7EBF2; }
[data-theme="dark"] .progress-bar-wrap { background: rgba(167,235,242,0.2); }
[data-theme="dark"] .progress-bar-wrap > div { background: rgba(167,235,242,0.8); }
[data-theme="dark"] .progress-bar-wrap > div::after {
    background: #A7EBF2;
    box-shadow: 0 2px 8px rgba(0,0,0,0.4);
}

/* ══════════════════════════════════════════
   ACHIEVEMENT OVERLAY
   ══════════════════════════════════════════ */
#achievement-overlay {
    position: fixed; inset: 0; z-index: 9999;
    display: flex; align-items: center; justify-content: center;
    background: rgba(0,0,0,0);
    backdrop-filter: blur(0px);
    transition: background 0.35s, backdrop-filter 0.35s;
    pointer-events: none;
}
#achievement-overlay.ach-visible {
    background: rgba(0,0,0,0.58);
    backdrop-filter: blur(8px);
    pointer-events: all;
}

.ach-card {
    background: var(--card);
    border-radius: 28px;
    padding: 28px 24px 22px;
    display: flex; flex-direction: column; align-items: center; gap: 10px;
    box-shadow: 0 24px 60px rgba(0,0,0,0.35), 0 0 0 1.5px rgba(255,255,255,0.08);
    max-width: 300px; width: 88%;
    transform: scale(0.72) translateY(40px);
    opacity: 0;
    transition: transform 0.45s cubic-bezier(0.34,1.56,0.64,1), opacity 0.35s;
}
.ach-card.ach-card-in {
    transform: scale(1) translateY(0);
    opacity: 1;
}

/* Canvas + число поверх */
.ach-canvas-wrap {
    position: relative;
    width: 180px; height: 180px;
    flex-shrink: 0;
}
#ach-canvas {
    border-radius: 50%;
    width: 180px; height: 180px;
    display: block;
    filter: drop-shadow(0 8px 24px rgba(0,0,0,0.28));
}
.ach-count-badge {
    position: absolute;
    bottom: 6px; right: 6px;
    min-width: 44px; height: 44px;
    border-radius: 22px;
    background: linear-gradient(135deg, var(--accent), #54ACBF);
    color: #fff;
    font-family: var(--font-display);
    font-size: 22px; font-weight: 800 !important;
    line-height: 44px;
    text-align: center;
    padding: 0 8px;
    box-shadow: 0 3px 12px rgba(0,0,0,0.3), 0 0 0 3px var(--card);
    letter-spacing: -0.5px;
}

.ach-label {
    font-family: var(--font-display);
    font-size: 16px; font-weight: 700 !important;
    color: var(--text);
    text-align: center;
    line-height: 1.3;
}

.ach-sub {
    font-family: var(--font-display);
    font-size: 12px; font-weight: 500;
    color: var(--text2);
    text-align: center;
    letter-spacing: 0.06em;
    text-transform: uppercase;
}

/* Progress bar — обратный отсчёт */
.ach-progress-bar {
    width: 100%; height: 3px;
    background: var(--border);
    border-radius: 2px;
    overflow: hidden;
    margin-top: 2px;
}
.ach-progress-fill {
    height: 100%;
    width: 100%;
    background: linear-gradient(90deg, var(--accent), #A7EBF2);
    border-radius: 2px;
    transition: width 10s linear;
}

.ach-btns {
    display: flex; gap: 10px; width: 100%; margin-top: 4px;
}

.ach-share-btn, .ach-close-btn {
    flex: 1; padding: 12px 8px;
    border-radius: 12px;
    border: none; cursor: pointer;
    font-family: var(--font-display);
    font-size: 14px; font-weight: 600 !important;
    display: flex; align-items: center; justify-content: center; gap: 6px;
    transition: all var(--tr);
}
.ach-share-btn {
    background: linear-gradient(135deg, var(--accent), #54ACBF);
    color: #fff;
    box-shadow: 0 4px 14px rgba(0,0,0,0.18);
}
.ach-share-btn:hover { opacity: 0.88; transform: scale(1.02); }
.ach-close-btn {
    background: var(--card2);
    color: var(--text2);
    border: 1.5px solid var(--border);
}
.ach-close-btn:hover { color: var(--text); border-color: var(--text2); }

/* ══ LEARNING CARDS ══ */
.stat-learn-card {
    cursor: pointer;
    user-select: none;
}
.stat-learn-card:active { opacity: 0.85; }

/* Скрытый аккордеон — разворачивается по клику */
.learn-accordion {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.35s ease, padding 0.35s ease;
    padding: 0 12px;
}
.learn-accordion.open {
    max-height: 500px;
    padding: 10px 12px 14px;
}

.learn-detail-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 6px;
    margin-bottom: 8px;
}
.learn-item {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 36px;
    height: 32px;
    padding: 0 8px;
    border-radius: 10px;
    background: var(--card2);
    border: 1.5px solid var(--border);
    font-size: 14px;
    font-weight: 600;
    color: var(--text2);
    opacity: 0.45;
    transition: all 0.2s ease;
}
.learn-item.done {
    opacity: 1;
    background: rgba(34,197,94,0.12);
    border-color: rgba(34,197,94,0.3);
    color: #16a34a;
}
[data-theme="dark"] .learn-item.done {
    background: rgba(34,197,94,0.18);
    color: #4ade80;
}
.learn-detail-summary {
    font-size: 12px;
    color: var(--text2);
    text-align: center;
    font-weight: 600;
}

/* Стрелка поворачивается при раскрытии */
.stat-learn-card svg[style] {
    transition: transform 0.3s ease;
}
.stat-learn-card.open svg[style] {
    transform: rotate(180deg);
}

/* ══ FULLSCREEN LEARN PANEL ══ */
#learn-panel {
    position: fixed;
    top: 0; bottom: 0; z-index: 8000;
    /* Повторяем логику #app — центрируем и ограничиваем ширину */
    left: 50%;
    transform: translateX(-50%) translateY(100%);
    width: 100%;
    max-width: 480px;
    background: var(--bg);
    display: flex; flex-direction: column;
    transition: transform 0.32s cubic-bezier(0.4, 0, 0.2, 1);
    will-change: transform;
}
#learn-panel.open {
    transform: translateX(-50%) translateY(0);
}

.learn-panel-header {
    display: flex; align-items: center; gap: 14px;
    padding: 16px 16px 14px;
    background: var(--card);
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
    box-shadow: 0 2px 12px rgba(0,0,0,0.12);
}
.learn-panel-back {
    display: flex; align-items: center; gap: 6px;
    background: var(--card2); border: none; cursor: pointer;
    color: var(--text); border-radius: 12px;
    padding: 8px 12px;
    font-family: var(--font-display);
    font-size: 14px; font-weight: 600 !important;
    transition: background var(--tr);
    flex-shrink: 0;
}
.learn-panel-back:hover { background: var(--border); }
.learn-panel-title {
    font-family: var(--font-display);
    font-size: 20px; font-weight: 700 !important;
    color: var(--text); flex: 1;
}
.learn-panel-sub {
    font-size: 12px; color: var(--text2);
    margin-top: 2px;
}

.learn-panel-body {
    flex: 1;
    overflow-y: auto;
    -webkit-overflow-scrolling: touch;
    padding: 8px 0 24px;
}

.learn-detail-row {
    display: flex; align-items: center; gap: 12px;
    padding: 11px 20px;
    border-bottom: 1px solid var(--border);
    transition: background var(--tr);
}
.learn-detail-row:last-child { border-bottom: none; }
.learn-detail-row.zero { opacity: 0.38; }
.learn-detail-row:not(.zero):active { background: var(--card2); }

.learn-detail-name {
    font-family: var(--font-display);
    font-size: 16px; font-weight: 600 !important;
    min-width: 80px; flex-shrink: 0;
    color: var(--text);
}
.learn-detail-bar-wrap {
    flex: 1; height: 7px;
    background: var(--bg2);
    border-radius: 99px;
    overflow: hidden;
}
.learn-detail-bar {
    height: 100%; border-radius: 99px;
    background: linear-gradient(90deg, var(--accent), #A7EBF2);
    transition: width 0.5s ease;
    min-width: 0;
}
.learn-detail-cnt {
    font-family: var(--font-display);
    font-size: 15px; font-weight: 700 !important;
    color: var(--accent);
    min-width: 32px; text-align: right; flex-shrink: 0;
}

/* ══════════════════════════════════════════
   CHART — Активность
   ══════════════════════════════════════════ */
.chart-card {
    background: var(--card);
    border: 1px solid var(--border);
    border-radius: 18px;
    padding: 16px 16px 12px;
    box-shadow: var(--shadow);
    margin-bottom: 10px;
}
.chart-header {
    display: flex; align-items: center;
    margin-bottom: 12px; gap: 6px;
}
.chart-title {
    font-family: var(--font-display);
    font-size: 14px; font-weight: var(--fw-medium);
    color: var(--text); letter-spacing: 0.01em;
}

/* ── Info button ── */
.chart-info-btn {
    background: none; border: none; cursor: pointer;
    color: var(--text2); padding: 2px;
    border-radius: 50%; transition: all var(--tr);
    display: flex; align-items: center; justify-content: center;
    flex-shrink: 0; opacity: 0.5;
}
.chart-info-btn:hover { opacity: 1; color: var(--text); }
.chart-info-box {
    background: var(--card2);
    border-radius: 10px;
    padding: 10px 12px;
    margin-bottom: 10px;
    font-size: 12px; font-weight: var(--fw-normal);
    line-height: 1.7;
    color: var(--text2);
    border-left: 2px solid var(--accent);
    animation: chart-info-in 0.2s ease;
}
.chart-info-box b { color: var(--text); font-weight: var(--fw-medium); }
@keyframes chart-info-in {
    from { opacity: 0; transform: translateY(-4px); }
    to { opacity: 1; transform: translateY(0); }
}

/* ── Metric tabs (Ответы / Время) ── */
.chart-tabs {
    display: flex; gap: 3px; margin-left: auto;
}
.chart-tab {
    background: transparent; border: 1px solid var(--border); cursor: pointer;
    font-family: var(--font-display);
    font-size: 11px; font-weight: var(--fw-normal);
    color: var(--text2);
    padding: 4px 10px; border-radius: 99px;
    transition: all var(--tr);
    letter-spacing: 0.02em;
}
.chart-tab.active {
    background: var(--accent); color: #fff;
    border-color: var(--accent);
    font-weight: var(--fw-medium);
}
.chart-tab.active[data-metric="time"] {
    background: linear-gradient(135deg, #fcd34d, #f59e0b, #ea580c);
    border-color: #f59e0b;
}

/* ── Period tabs ── */
.chart-period-tabs {
    display: flex; gap: 0; margin-bottom: 10px;
    background: var(--card2);
    border-radius: 8px;
    padding: 2px;
}
.chart-period {
    flex: 1; background: none; border: none; cursor: pointer;
    font-family: var(--font-display);
    font-size: 11px; font-weight: var(--fw-normal);
    color: var(--text2);
    padding: 5px 4px; border-radius: 6px;
    transition: all var(--tr);
    white-space: nowrap;
    letter-spacing: 0.01em;
}
.chart-period.active {
    background: var(--card);
    color: var(--text);
    font-weight: var(--fw-medium);
    box-shadow: 0 1px 3px rgba(0,0,0,0.08);
}
.hourly-period { cursor: default; text-align: center; pointer-events: none; }

/* ── Chart area ── */
.chart-area { width: 100%; }
.chart-bars {
    display: flex; align-items: flex-end; gap: 2px;
    height: 84px;
    padding: 0 2px;
}
.chart-bar-wrap {
    flex: 1;
    display: flex; flex-direction: column;
    align-items: center; justify-content: flex-end;
    height: 100%; gap: 2px;
    min-width: 0;
}
.chart-bar-tip {
    font-size: 9px; font-weight: var(--fw-normal);
    color: var(--text2); line-height: 1;
    min-height: 11px; text-align: center;
    white-space: nowrap; opacity: 0.7;
}
.chart-bar {
    width: 100%;
    border-radius: 3px 3px 1px 1px;
    min-height: 0;
    transition: height 0.5s cubic-bezier(.4,0,.2,1);
}
.chart-bar-a {
    background: var(--accent);
    opacity: 0.5;
}
.chart-bar-t {
    background: #f59e0b;
    background: linear-gradient(180deg, #fcd34d, #f59e0b, #ea580c);
    opacity: 0.5;
}
.chart-bar-wrap.today .chart-bar-a {
    background: linear-gradient(180deg, #c8f0f5, var(--accent));
    opacity: 0.9;
}
.chart-bar-wrap.today .chart-bar-t {
    background: #f59e0b;
    background: linear-gradient(180deg, #fcd34d, #f59e0b, #ea580c);
    opacity: 0.9;
}
/* Ограничение ширины в режиме «Всё время» с малым кол-вом столбиков */
.chart-bars.chart-bars-wide .chart-bar-wrap {
    max-width: 50px;
}
.chart-bars.chart-bars-wide {
    justify-content: center;
}
.chart-dual-slot {
    display: flex; gap: 2px;
    width: 100%;
    flex: 1;
    min-height: 0;
    align-items: flex-end;
}
.chart-dual-col {
    flex: 1;
    display: flex; flex-direction: column;
    align-items: center; justify-content: flex-end;
    min-width: 0;
    height: 100%; gap: 2px;
}
.chart-dual-col .chart-bar {
    width: 100%; border-radius: 3px 3px 1px 1px;
}
.chart-dual-col .chart-bar-tip {
    font-size: 9px;
}
.chart-labels {
    display: flex; gap: 2px;
    padding: 5px 2px 0;
    border-top: 1px solid var(--border);
    margin-top: 4px;
}
.chart-label {
    flex: 1; text-align: center;
    font-size: 10px; font-weight: var(--fw-normal);
    color: var(--text2);
    white-space: nowrap; overflow: visible;
    min-width: 0; opacity: 0.55;
}
.chart-label.today {
    color: var(--accent); font-weight: var(--fw-medium); opacity: 1;
}

/* ── Legend + Period footer (unified) ── */
.chart-footer {
    display: flex; align-items: center; justify-content: space-between;
    padding: 8px 2px 2px;
    font-size: 10px; font-weight: var(--fw-normal);
    color: var(--text2);
    letter-spacing: 0.01em;
}
.chart-footer-legend {
    display: flex; align-items: center; gap: 4px;
    white-space: nowrap;
}
.chart-footer-period {
    white-space: nowrap;
    opacity: 0.6;
    color: var(--accent);
}
.chart-legend-dot {
    display: inline-block; width: 6px; height: 6px;
    border-radius: 50%; margin-right: 4px;
}
.chart-legend-a { background: var(--accent); }
.chart-legend-t { background: #f59e0b; }
/* wide mode for labels too */
.chart-labels.chart-bars-wide {
    justify-content: center;
}
.chart-labels.chart-bars-wide .chart-label {
    max-width: 50px;
}

/* day pair styles removed — Day now uses unified bar layout */

/* ── Hourly chart specifics ── */
.hourly-bars { height: 84px; gap: 2px; padding: 0 2px; justify-content: center; }
.hourly-bars .chart-bar-wrap { max-width: 50px; }
.hourly-labels { gap: 2px; padding: 3px 2px 0; justify-content: center; }
.hourly-labels .chart-label { font-size: 9px; max-width: 50px; }
#hourly-chart-card { margin-bottom: 14px; display: flex; flex-direction: column; }
#hourly-chart-card .chart-header { padding-bottom: 6px; }
#hourly-chart-card .chart-area { flex: 1; display: flex; flex-direction: column; justify-content: flex-end; }

/* ══ Кнопка итогов месяца ══ */
.month-summary-btn {
    width: 100%;
    display: flex; align-items: center; justify-content: center; gap: 8px;
    background: var(--card);
    border: 1.5px solid var(--border);
    cursor: pointer; border-radius: 18px;
    padding: 14px 16px;
    font-family: var(--font-display);
    font-size: 15px; font-weight: 500 !important;
    color: var(--text);
    box-shadow: var(--shadow);
    margin: 18px 0;
    transition: all var(--tr);
}
.month-summary-btn .icon-svg { color: var(--text2); }
.month-summary-btn:hover  { transform: translateY(-1px); box-shadow: var(--shadow-lg); }
.month-summary-btn:active { transform: scale(0.98); }

/* ══ Оверлей итогов месяца ══ */
#month-overlay {
    position: fixed; inset: 0; z-index: 9990;
    background: rgba(0,0,0,0);
    backdrop-filter: blur(0px);
    display: flex; align-items: flex-end; justify-content: center;
    transition: background 0.3s, backdrop-filter 0.3s;
    pointer-events: none;
}
#month-overlay.visible {
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(8px);
    pointer-events: all;
}
.month-card {
    background: var(--card);
    border-radius: 24px 24px 0 0;
    width: 100%; max-width: 480px;
    padding: 0 0 24px;
    transform: translateY(100%);
    transition: transform 0.35s cubic-bezier(0.34,1.1,0.64,1);
    max-height: 92vh;
    display: flex; flex-direction: column;
    overflow: hidden;
}
.month-card.in { transform: translateY(0); }

.month-card-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 18px 20px 14px;
    border-bottom: 1px solid var(--border);
    flex-shrink: 0;
}
.month-card-title {
    font-family: var(--font-display);
    font-size: 17px; font-weight: 700 !important;
    color: var(--text);
}
.month-close-btn {
    background: var(--card2); border: none; cursor: pointer;
    width: 32px; height: 32px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    color: var(--text2); transition: background var(--tr);
}
.month-close-btn:hover { background: var(--border); }

.month-preview-wrap {
    flex: 1; overflow-y: auto;
    padding: 16px 16px 8px;
}
.month-preview-img {
    width: 100%; border-radius: 16px;
    box-shadow: 0 8px 32px rgba(0,0,0,0.25);
    display: block;
}

.month-card-btns {
    display: flex; gap: 10px;
    padding: 12px 16px 0;
    flex-shrink: 0;
}
.month-share-btn, .month-download-btn {
    flex: 1; padding: 13px 8px;
    border-radius: 12px;
    border: none; cursor: pointer;
    font-family: var(--font-display);
    font-size: 14px; font-weight: 600 !important;
    display: flex; align-items: center; justify-content: center; gap: 7px;
    transition: all var(--tr);
}
.month-share-btn {
    background: linear-gradient(135deg, var(--accent), #54ACBF);
    color: #fff;
    box-shadow: 0 4px 12px rgba(84,172,191,0.3);
}
.month-share-btn:hover { opacity: 0.88; }
.month-download-btn {
    background: var(--card2);
    color: var(--text);
    border: 1.5px solid var(--border);
}
.month-download-btn:hover { border-color: var(--accent); color: var(--accent); }

/* =============================================
   WORDS — Собери слово
   ============================================= */
.words-emoji {
    text-align: center;
    font-size: 80px;
    line-height: 1;
    margin: 8px 0 16px;
    animation: words-emoji-bounce 0.5s ease;
}
@keyframes words-emoji-bounce {
    0%   { transform: scale(0.3); opacity: 0; }
    50%  { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
}

.words-slots {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 20px;
    flex-wrap: wrap;
}
.words-slot {
    width: 48px;
    height: 56px;
    border-radius: 14px;
    border: 2.5px dashed var(--border);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    font-weight: 700;
    color: var(--text);
    background: var(--card);
    transition: all 0.2s ease;
    cursor: default;
    outline: none;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
}
.words-slot:focus {
    outline: none;
}
.words-slot.filled {
    border-style: solid;
    border-color: #a78bfa;
    background: rgba(167,139,250,0.1);
    cursor: pointer;
    animation: words-slot-pop 0.25s ease;
}
/* Подавляем анимации при загрузке нового задания */
.no-anim .words-slot,
.no-anim .words-tile {
    animation: none !important;
    transition: none !important;
}
.words-slot.correct {
    border-color: #22c55e;
    background: rgba(34,197,94,0.15);
    color: #16a34a;
    animation: words-slot-correct 0.4s ease;
}
[data-theme="dark"] .words-slot.correct {
    color: #4ade80;
    background: rgba(34,197,94,0.2);
}
@keyframes words-slot-pop {
    0%   { transform: scale(0.8); }
    50%  { transform: scale(1.08); }
    100% { transform: scale(1); }
}
@keyframes words-slot-correct {
    0%   { transform: scale(1); }
    40%  { transform: scale(1.15); }
    100% { transform: scale(1); }
}

.words-tiles {
    display: flex;
    justify-content: center;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 16px;
    min-height: 52px;
}
.words-tile {
    width: 48px;
    height: 52px;
    border-radius: 14px;
    border: 2px solid var(--border);
    background: var(--card);
    box-shadow: var(--shadow), 0 3px 0 rgba(0,0,0,0.08);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 22px;
    font-weight: 700;
    color: var(--text);
    cursor: pointer;
    transition: all 0.15s ease;
    user-select: none;
    -webkit-user-select: none;
    -webkit-tap-highlight-color: transparent;
    -webkit-touch-callout: none;
    outline: none;
}
.words-tile:focus {
    outline: none;
    border-color: var(--border);
}
.words-tile:focus-visible {
    border-color: #a78bfa;
}
.words-tile:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg);
    border-color: #a78bfa;
}
.words-tile:active {
    transform: scale(0.92);
}
.words-tile.used {
    opacity: 0.15;
    pointer-events: none;
    transform: scale(0.85);
}

.words-msg {
    text-align: center;
    min-height: 28px;
    font-size: 16px;
    font-weight: 600;
    margin-bottom: 8px;
    transition: all 0.3s ease;
}
.words-msg-ok {
    color: #22c55e;
    animation: words-msg-pop 0.4s ease;
}
.words-msg-err {
    color: #ef4444;
}
@keyframes words-msg-pop {
    0%   { transform: scale(0.8); opacity: 0; }
    50%  { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
}

.words-shake {
    animation: words-shake-anim 0.4s ease;
}
@keyframes words-shake-anim {
    0%, 100% { transform: translateX(0); }
    20%      { transform: translateX(-8px); }
    40%      { transform: translateX(8px); }
    60%      { transform: translateX(-5px); }
    80%      { transform: translateX(5px); }
}

.words-level-row {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-bottom: 12px;
}
.words-lvl-btn {
    padding: 8px 18px;
    border-radius: 12px;
    border: 1.5px solid var(--border);
    background: var(--card);
    color: var(--text2);
    font-family: var(--font);
    font-size: 14px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}
.words-lvl-btn:hover {
    border-color: #a78bfa;
    color: var(--text);
}
.words-lvl-btn.active {
    background: var(--grad);
    color: white;
    border-color: transparent;
    box-shadow: 0 3px 12px rgba(120,100,220,0.3);
}

.words-score-row {
    text-align: center;
    font-size: 15px;
    color: var(--text2);
    margin-bottom: 4px;
}
.words-score-row span {
    font-weight: 700;
    font-size: 20px;
    color: #f59e0b;
}

.words-hint-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 10px 20px;
    border-radius: 14px;
    border: 1.5px solid var(--border);
    background: var(--card);
    color: var(--text2);
    font-family: var(--font);
    font-size: 15px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s ease;
}
.words-hint-btn .icon-svg {
    width: 18px;
    height: 18px;
    color: #eab308;
}
.words-hint-btn:hover {
    border-color: #eab308;
    color: var(--text);
    transform: translateY(-1px);
}
.words-hint-btn:active {
    transform: scale(0.97);
}

/* =============================================
   BADGES — Коллекция достижений
   ============================================= */
.badges-header {
    display: flex;
    align-items: center;
    gap: 16px;
    padding: 12px 4px 24px;
    animation: fadeInUp 0.4s ease both;
}
.badges-mascot-wrap {
    flex-shrink: 0;
    width: 64px;
    height: 64px;
    border-radius: 20px;
    background: var(--card);
    box-shadow: var(--shadow);
    overflow: visible;
    position: relative;
}
.badges-mascot-wrap::before {
    content: '';
    position: absolute;
    inset: -3px;
    border-radius: 22px;
    background: conic-gradient(
        from var(--mascot-angle, 0deg),
        rgba(251,191,36,0.15) 0%,
        rgba(251,191,36,0.15) 30%,
        rgba(255,230,150,0.8) 45%,
        rgba(251,191,36,1) 50%,
        rgba(255,230,150,0.8) 55%,
        rgba(251,191,36,0.15) 70%,
        rgba(251,191,36,0.15) 100%
    );
    animation: mascot-shimmer 10s linear infinite;
    z-index: -1;
    mask:
        linear-gradient(#000, #000) content-box,
        linear-gradient(#000, #000);
    mask-composite: exclude;
    -webkit-mask:
        linear-gradient(#000, #000) content-box,
        linear-gradient(#000, #000);
    -webkit-mask-composite: destination-out;
    padding: 3px;
}
@keyframes mascot-shimmer {
    from { --mascot-angle: 0deg; }
    to   { --mascot-angle: 360deg; }
}
@property --mascot-angle {
    syntax: '<angle>';
    initial-value: 0deg;
    inherits: false;
}
.badges-mascot {
    width: 64px;
    height: 64px;
    object-fit: cover;
    display: block;
    border-radius: 20px;
}
.badges-summary {
    flex: 1;
    min-width: 0;
}
.badges-count {
    font-size: 26px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.2;
}
.badges-count span:first-child {
    color: #f59e0b;
}
.badges-label {
    font-size: 13px;
    color: var(--text2);
    margin-top: 2px;
}
.badges-bar {
    margin-top: 8px;
    height: 8px;
    border-radius: 4px;
    background: var(--card2);
    overflow: hidden;
}
.badges-bar-fill {
    height: 100%;
    border-radius: 4px;
    background: linear-gradient(90deg, #fbbf24, #f59e0b, #d97706);
    width: 0;
    transition: width 0.8s ease;
}

.badges-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 14px;
}

.badge-card {
    background: var(--card);
    border: 1.5px solid var(--border);
    border-radius: 16px;
    padding: 16px 8px 12px;
    text-align: center;
    box-shadow: var(--shadow);
    transition: all 0.35s ease;
    animation: fadeInUp 0.4s ease both;
    display: flex;
    flex-direction: column;
    align-items: center;
}
.badge-card:not(.unlocked) {
    opacity: 0.55;
}
.badge-card:not(.unlocked) .badge-icon-wrap {
    opacity: 0.35;
}
.badge-card:not(.unlocked) .badge-icon-wrap svg {
    stroke: var(--text2);
}
.badge-card:not(.unlocked) .badge-name {
    color: var(--text2);
    opacity: 0.5;
}
.badge-card:not(.unlocked) .badge-progress-fill {
    background: var(--text2);
    opacity: 0.25;
}
.badge-card:not(.unlocked) .badge-desc {
    color: var(--text2);
    opacity: 0.5;
}
.badge-card.unlocked {
    opacity: 1;
    border-color: transparent;
    background: linear-gradient(145deg, var(--card), rgba(251,191,36,0.08));
    box-shadow: var(--shadow), 0 0 20px rgba(251,191,36,0.12);
    position: relative;
    overflow: visible;
    z-index: 0;
}
.badge-card.unlocked:hover {
    transform: translateY(-3px);
    box-shadow: var(--shadow-lg), 0 0 28px rgba(251,191,36,0.2);
}

.badge-icon-wrap {
    width: 44px; height: 44px;
    margin-bottom: 6px;
    transition: transform 0.3s ease, filter 0.3s ease;
    position: relative;
    z-index: 0;
}
.badge-icon-wrap svg {
    width: 100%; height: 100%;
    stroke: var(--text2);
    position: relative;
    z-index: 1;
}
.badge-card.unlocked .badge-icon-wrap {
    width: 50px; height: 50px;
    filter: drop-shadow(0 2px 8px rgba(251,191,36,0.4));
    animation: badge-emoji-pop 0.6s ease both;
    position: relative;
}
.badge-card.unlocked .badge-icon-wrap svg {
    stroke: #fbbf24;
    filter: drop-shadow(0 0 3px rgba(251,191,36,0.3));
}

/* ── Золотой блик на карточке (как на маскоте) ── */
.badge-card.unlocked::before {
    content: '';
    position: absolute;
    inset: -2.5px;
    border-radius: 18px;
    background: conic-gradient(
        from var(--card-shimmer-angle, 0deg),
        rgba(251,191,36,0.15) 0%,
        rgba(251,191,36,0.15) 30%,
        rgba(255,230,150,0.8) 45%,
        rgba(251,191,36,1) 50%,
        rgba(255,230,150,0.8) 55%,
        rgba(251,191,36,0.15) 70%,
        rgba(251,191,36,0.15) 100%
    );
    animation: card-shimmer 10s linear infinite;
    z-index: -1;
    /* Вырезаем внутреннюю часть — оставляем только обводку 2.5px */
    mask:
        linear-gradient(#000, #000) content-box,
        linear-gradient(#000, #000);
    mask-composite: exclude;
    -webkit-mask:
        linear-gradient(#000, #000) content-box,
        linear-gradient(#000, #000);
    -webkit-mask-composite: destination-out;
    padding: 2.5px;
}
@keyframes card-shimmer {
    from { --card-shimmer-angle: 0deg; }
    to   { --card-shimmer-angle: 360deg; }
}
@property --card-shimmer-angle {
    syntax: '<angle>';
    initial-value: 0deg;
    inherits: false;
}
@keyframes badge-emoji-pop {
    0%   { transform: scale(0); }
    60%  { transform: scale(1.2); }
    100% { transform: scale(1); }
}

.badge-name {
    font-size: 13px;
    font-weight: 700;
    color: var(--text);
    line-height: 1.25;
    margin-bottom: 3px;
}
.badge-card.unlocked .badge-name {
    color: #d97706;
}
[data-theme="dark"] .badge-card.unlocked .badge-name {
    color: #fbbf24;
}
.badge-desc {
    font-size: 11px;
    color: var(--text2);
    line-height: 1.3;
    margin-bottom: 6px;
    min-height: 28px;
}
.badge-card.unlocked .badge-desc {
    color: #f59e0b;
    font-weight: 600;
}

.badge-progress-bottom {
    margin-top: auto;
    width: 100%;
}
.badge-progress-bar {
    height: 4px;
    border-radius: 2px;
    background: var(--card2);
    margin-bottom: 3px;
    overflow: hidden;
}
.badge-progress-fill {
    height: 100%;
    border-radius: 2px;
    background: linear-gradient(90deg, #e2e8f0, #94a3b8);
    transition: width 0.6s ease;
}
.badge-card.unlocked .badge-progress-fill {
    background: linear-gradient(90deg, #fbbf24, #f59e0b);
}

.badge-progress-text {
    font-size: 10px;
    color: var(--text2);
    font-weight: 600;
}

/* Dark theme */
[data-theme="dark"] .badge-card.unlocked {
    border-color: rgba(251,191,36,0.3);
    background: linear-gradient(145deg, var(--card), rgba(251,191,36,0.1));
    box-shadow: var(--shadow), 0 0 24px rgba(251,191,36,0.15);
}
[data-theme="dark"] .badge-card:not(.unlocked) .badge-icon-wrap svg {
    stroke: var(--luna-mid);
    opacity: 0.4;
}
[data-theme="dark"] .badge-card:not(.unlocked) .badge-name {
    color: var(--luna-mid);
    opacity: 0.4;
}
[data-theme="dark"] .badge-card:not(.unlocked) .badge-progress-fill {
    background: var(--luna-mid);
    opacity: 0.2;
}
[data-theme="dark"] .badge-card:not(.unlocked) .badge-desc {
    color: var(--luna-mid);
    opacity: 0.4;
}
[data-theme="dark"] .badges-mascot-wrap {
    box-shadow: 0 4px 24px rgba(84,172,191,0.2), var(--shadow);
}

/* =============================================
   GOSHA — Анимации маскота
   ============================================= */

/* Радостный прыжок — при возврате на главную */
.gosha-bounce {
    animation: gosha-bounce-anim 0.6s ease !important;
}
@keyframes gosha-bounce-anim {
    0%   { transform: translateY(0) scale(1); }
    25%  { transform: translateY(-12px) scale(1.05); }
    40%  { transform: translateY(-14px) scale(1.08) rotate(-3deg); }
    60%  { transform: translateY(0) scale(0.95); }
    80%  { transform: translateY(-4px) scale(1.02); }
    100% { transform: translateY(0) scale(1); }
}

/* Празднование — при получении значка */
.gosha-celebrate {
    animation: gosha-celebrate-anim 1s ease !important;
}
@keyframes gosha-celebrate-anim {
    0%   { transform: scale(1) rotate(0); }
    15%  { transform: scale(1.15) rotate(-5deg); }
    30%  { transform: scale(1.1) rotate(5deg) translateY(-8px); }
    45%  { transform: scale(1.15) rotate(-3deg) translateY(-10px); }
    60%  { transform: scale(1.1) rotate(3deg) translateY(-6px); }
    75%  { transform: scale(1.05) rotate(-1deg) translateY(-2px); }
    100% { transform: scale(1) rotate(0) translateY(0); }
}

/* Радостный — на странице достижений при 5+ значках */
@keyframes gosha-happy-anim {
    0%, 100% { transform: translateY(0) rotate(0); }
    20%  { transform: translateY(-6px) rotate(-3deg); }
    40%  { transform: translateY(0) rotate(0); }
    60%  { transform: translateY(-4px) rotate(3deg); }
    80%  { transform: translateY(0) rotate(0); }
}

/* Танец — на странице достижений при 18+ значках */
@keyframes gosha-dance-anim {
    0%, 100% { transform: translateY(0) rotate(0) scale(1); }
    10%  { transform: translateY(-8px) rotate(-5deg) scale(1.05); }
    20%  { transform: translateY(0) rotate(5deg) scale(1); }
    30%  { transform: translateY(-10px) rotate(-8deg) scale(1.08); }
    40%  { transform: translateY(0) rotate(0) scale(1); }
    55%  { transform: translateY(-6px) rotate(6deg) scale(1.05); }
    70%  { transform: translateY(0) rotate(-3deg) scale(1); }
    85%  { transform: translateY(-4px) rotate(0) scale(1.03); }
}

/* Адаптив: 2 колонки на совсем маленьких экранах */
@media (max-width: 360px) {
    .badges-grid { grid-template-columns: repeat(2, 1fr); }
}

/* =============================================
   ARITHMETIC — Арифметика
   ============================================= */
.math-problem {
    text-align: center;
    font-size: 42px;
    font-weight: 800;
    color: var(--text);
    padding: 20px 0 18px;
    line-height: 1.1;
    letter-spacing: 0.02em;
    animation: words-emoji-bounce 0.5s ease;
    background: var(--grad);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* ═══════════════════════════════════════════
   INTERSTITIALS — Перебивки
   ═══════════════════════════════════════════ */

/* Оверлей с размытием фона */
#inter-overlay {
    position: fixed;
    inset: 0;
    z-index: 100000;
    display: flex;
    align-items: flex-start;
    justify-content: center;
    padding-top: max(60px, env(safe-area-inset-top, 20px) + 40px);
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    opacity: 0;
    transition: opacity 0.3s ease;
}
#inter-overlay.inter-visible {
    opacity: 1;
}

/* Карточка задания */
.inter-card {
    background: var(--card);
    border-radius: var(--radius);
    box-shadow: var(--shadow-lg), 0 0 0 1px var(--border);
    padding: 28px 24px 22px;
    width: min(380px, calc(100vw - 32px));
    text-align: center;
    animation: inter-slide-in 0.4s cubic-bezier(.34,1.56,.64,1) both;
    max-height: calc(100vh - 120px);
    max-height: calc(100dvh - 120px);
    overflow-y: auto;
}
@keyframes inter-slide-in {
    from { opacity: 0; transform: translateY(-30px) scale(0.92); }
    to   { opacity: 1; transform: translateY(0) scale(1); }
}
.inter-card-pop {
    animation: inter-slide-in 0.35s cubic-bezier(.34,1.56,.64,1) both;
}

/* Заголовок */
.inter-title {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 700;
    color: var(--text);
    margin-bottom: 18px;
    line-height: 1.2;
}

/* Дисплей эмодзи (тип 2 и 5) */
.inter-emoji-display {
    font-size: 36px;
    line-height: 1.6;
    padding: 16px 12px;
    min-height: 70px;
    word-break: break-word;
    letter-spacing: 6px;
}

/* Тип 3: цветной кружок */
.inter-color-display {
    display: flex;
    justify-content: center;
    padding: 12px 0 8px;
}
.inter-color-circle {
    width: 100px;
    height: 100px;
    border-radius: 50%;
    box-shadow: 0 4px 16px rgba(0,0,0,0.18), inset 0 -2px 6px rgba(0,0,0,0.1);
    border: 4px solid var(--border);
}

/* Тип 4: слово с пропуском */
.inter-word-display {
    padding: 10px 0;
}
.inter-word-gap {
    font-family: var(--font-display);
    font-size: 44px;
    font-weight: 800;
    letter-spacing: 10px;
    color: var(--text);
    background: var(--grad);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

/* Тип 5: таймер */
.inter-timer-bar {
    height: 6px;
    background: var(--card2);
    border-radius: 3px;
    margin: 14px 0 6px;
    overflow: hidden;
}
.inter-timer-fill {
    height: 100%;
    width: 0;
    background: var(--grad);
    border-radius: 3px;
    transition: width 3s linear;
}
.inter-hint {
    font-size: 14px;
    color: var(--text2);
    margin-top: 4px;
}

/* Тип 5: мигание */
.inter-memory-flash {
    animation: inter-flash-pulse 0.6s ease infinite alternate;
}
@keyframes inter-flash-pulse {
    from { opacity: 1; }
    to   { opacity: 0.7; }
}
.inter-memory-question {
    font-size: 60px;
    padding: 16px 0;
    animation: inter-think 1s ease infinite;
}
@keyframes inter-think {
    0%, 100% { transform: scale(1); }
    50%      { transform: scale(1.1); }
}

/* Кнопки вариантов ответа */
.inter-options {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 10px;
    margin-top: 18px;
}
.inter-opt-btn {
    font-family: var(--font);
    font-size: 17px;
    font-weight: 600;
    padding: 14px 10px;
    border-radius: var(--radius-sm);
    border: 2px solid var(--border);
    background: var(--card2);
    color: var(--text);
    cursor: pointer;
    transition: all 0.18s ease;
    -webkit-tap-highlight-color: transparent;
}
.inter-opt-btn:active:not(:disabled) {
    transform: scale(0.96);
}
.inter-opt-btn:disabled {
    cursor: default;
}
.inter-opt-btn.inter-correct {
    background: #22c55e !important;
    border-color: #16a34a !important;
    color: #fff !important;
    animation: inter-correct-pop 0.35s ease;
}
.inter-opt-btn.inter-wrong {
    background: #ef4444 !important;
    border-color: #dc2626 !important;
    color: #fff !important;
    animation: inter-shake 0.4s ease;
}
@keyframes inter-correct-pop {
    0%   { transform: scale(1); }
    50%  { transform: scale(1.08); }
    100% { transform: scale(1); }
}
@keyframes inter-shake {
    0%, 100% { transform: translateX(0); }
    20%      { transform: translateX(-6px); }
    40%      { transform: translateX(6px); }
    60%      { transform: translateX(-4px); }
    80%      { transform: translateX(4px); }
}

/* Тип 6: сетка из 4 больших эмодзи */
.inter-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 12px;
    margin-top: 18px;
}
.inter-grid-btn {
    font-size: 48px;
    padding: 18px;
    border-radius: var(--radius);
    border: 3px solid var(--border);
    background: var(--card2);
    cursor: pointer;
    transition: all 0.18s ease;
    -webkit-tap-highlight-color: transparent;
}
.inter-grid-btn:active:not(:disabled) {
    transform: scale(0.94);
}
.inter-grid-btn:disabled {
    cursor: default;
}
.inter-grid-btn.inter-correct {
    border-color: #22c55e !important;
    background: rgba(34,197,94,0.15) !important;
    animation: inter-correct-pop 0.35s ease;
}
.inter-grid-btn.inter-wrong {
    border-color: #ef4444 !important;
    background: rgba(239,68,68,0.15) !important;
    animation: inter-shake 0.4s ease;
}

/* Счёт внизу карточки */
.inter-score {
    margin-top: 16px;
    font-size: 13px;
    color: var(--text2);
}
.inter-score b {
    color: var(--text);
    font-weight: 700;
}

/* Статистика: иконка и цвет */
.si-inter {
    background: linear-gradient(135deg, #f59e0b, #fbbf24);
}
.sf-inter {
    background: linear-gradient(90deg, #f59e0b, #fbbf24);
}

/* Настройки: иконки */
.si-snd-inter, .si-snd-inter2 {
    background: linear-gradient(135deg, #f59e0b, #f97316);
}
